"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=812,exports.ids=[812],exports.modules={49812:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DashboardModule:()=>DashboardModule});var router=__webpack_require__(74202),user_type=__webpack_require__(32457),core=__webpack_require__(5e3),help_service=__webpack_require__(43250);class LoggedGuardSuperadminService{constructor(router2,helpService){this.router=router2,this.helpService=helpService}canActivate(){return this.helpService.getUserType()==user_type.F.superadmin||(this.router.navigate(["/dashboard/user"]),!1)}}__name(LoggedGuardSuperadminService,"LoggedGuardSuperadminService"),LoggedGuardSuperadminService.\u0275fac=__name(function(t){return new(t||LoggedGuardSuperadminService)(core.LFG(router.F0),core.LFG(help_service.s))},"LoggedGuardSuperadminService_Factory"),LoggedGuardSuperadminService.\u0275prov=core.Yz7({token:LoggedGuardSuperadminService,factory:LoggedGuardSuperadminService.\u0275fac,providedIn:"root"});class LoggedGuardUserService{constructor(router2,helpService){this.router=router2,this.helpService=helpService}canActivate(){return this.helpService.getUserType()==user_type.F.user||(this.router.navigate(["/dashboard/superadmin"]),!1)}}__name(LoggedGuardUserService,"LoggedGuardUserService"),LoggedGuardUserService.\u0275fac=__name(function(t){return new(t||LoggedGuardUserService)(core.LFG(router.F0),core.LFG(help_service.s))},"LoggedGuardUserService_Factory"),LoggedGuardUserService.\u0275prov=core.Yz7({token:LoggedGuardUserService,factory:LoggedGuardUserService.\u0275fac,providedIn:"root"});class UploadsComponent{constructor(){}ngOnInit(){}}__name(UploadsComponent,"UploadsComponent"),UploadsComponent.\u0275fac=__name(function(t){return new(t||UploadsComponent)},"UploadsComponent_Factory"),UploadsComponent.\u0275cmp=core.Xpm({type:UploadsComponent,selectors:[["app-uploads"]],decls:2,vars:0,template:__name(function(rf,ctx){1&rf&&(core.TgZ(0,"p"),core._uU(1,"uploads works!"),core.qZA())},"UploadsComponent_Template")});const routes=[{path:"",redirectTo:"superadmin",pathMatch:"full"},{path:"uploads",component:UploadsComponent},{path:"superadmin",canActivate:[LoggedGuardSuperadminService],loadChildren:()=>__webpack_require__.e(297).then(__webpack_require__.bind(__webpack_require__,6297)).then(m=>m.SuperadminModule)},{path:"user",canActivate:[LoggedGuardUserService],loadChildren:()=>__webpack_require__.e(407).then(__webpack_require__.bind(__webpack_require__,20407)).then(m=>m.UsersModule)},{path:"settings",loadChildren:()=>__webpack_require__.e(873).then(__webpack_require__.bind(__webpack_require__,45873)).then(m=>m.ProfileSettingsdModule)}];class DashboardRouting{}__name(DashboardRouting,"DashboardRouting"),DashboardRouting.\u0275fac=__name(function(t){return new(t||DashboardRouting)},"DashboardRouting_Factory"),DashboardRouting.\u0275mod=core.oAB({type:DashboardRouting}),DashboardRouting.\u0275inj=core.cJS({imports:[router.Bz.forChild(routes),router.Bz]});var common=__webpack_require__(69808),dynamic_module=__webpack_require__(28700),syncfusion_ej2_angular_splitbuttons=__webpack_require__(80664),ngx_image_cropper=__webpack_require__(83877),ngx_image_compress=__webpack_require__(73713);class DashboardModule{}__name(DashboardModule,"DashboardModule"),DashboardModule.\u0275fac=__name(function(t){return new(t||DashboardModule)},"DashboardModule_Factory"),DashboardModule.\u0275mod=core.oAB({type:DashboardModule}),DashboardModule.\u0275inj=core.cJS({providers:[ngx_image_compress.r],imports:[common.ez,DashboardRouting,dynamic_module.w,syncfusion_ej2_angular_splitbuttons.Q,ngx_image_cropper.QG]})},73713:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>DOC_ORIENTATION,r:()=>NgxImageCompressService});var DOC_ORIENTATION,DOC_ORIENTATION2,_angular_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5e3),tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(97582);(DOC_ORIENTATION2=DOC_ORIENTATION||(DOC_ORIENTATION={}))[DOC_ORIENTATION2.Up=1]="Up",DOC_ORIENTATION2[DOC_ORIENTATION2.Down=3]="Down",DOC_ORIENTATION2[DOC_ORIENTATION2.Right=6]="Right",DOC_ORIENTATION2[DOC_ORIENTATION2.Left=8]="Left",DOC_ORIENTATION2[DOC_ORIENTATION2.UpMirrored=2]="UpMirrored",DOC_ORIENTATION2[DOC_ORIENTATION2.DownMirrored=4]="DownMirrored",DOC_ORIENTATION2[DOC_ORIENTATION2.LeftMirrored=5]="LeftMirrored",DOC_ORIENTATION2[DOC_ORIENTATION2.RightMirrored=7]="RightMirrored",DOC_ORIENTATION2[DOC_ORIENTATION2.Default=0]="Default",DOC_ORIENTATION2[DOC_ORIENTATION2.NotJpeg=-1]="NotJpeg",DOC_ORIENTATION2[DOC_ORIENTATION2.NotDefined=-2]="NotDefined";class ImageCompress{}__name(ImageCompress,"ImageCompress"),ImageCompress.getOrientation=file=>new Promise((resolve,reject)=>{try{const reader=new FileReader;reader.onload=()=>{const view=new DataView(reader.result);if(!view.byteLength||65496!==view.getUint16(0,!1))return resolve(DOC_ORIENTATION.NotDefined);const length=view.byteLength;let offset=2;for(;offset<length;){const marker=view.getUint16(offset,!1);if(offset+=2,65505===marker){if(1165519206!==view.getUint32(offset+=2,!1))return resolve(DOC_ORIENTATION.NotJpeg);const little=18761===view.getUint16(offset+=6,!1);offset+=view.getUint32(offset+4,little);const tags=view.getUint16(offset,little);offset+=2;for(let i=0;i<tags;i++)if(274===view.getUint16(offset+12*i,little))return resolve(view.getUint16(offset+12*i+8,little))}else{if(65280!=(65280&marker))break;offset+=view.getUint16(offset,!1)}}return resolve(DOC_ORIENTATION.NotJpeg)},reader.readAsArrayBuffer(file)}catch{return reject(DOC_ORIENTATION.Default)}}),ImageCompress.uploadFile=(render,multiple=!0,rejectOnCancel=!1)=>new Promise(function(resolve,reject){const isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),isIOS=/iPad|iPhone|iPod/i.test(navigator.userAgent);Promise.resolve(isSafari||isIOS).then(onlyNative=>onlyNative?ImageCompress.generateUploadInputNative(window.document,multiple,rejectOnCancel):ImageCompress.generateUploadInputRenderer(render,multiple,rejectOnCancel)).then(filesList=>{const files=filesList?Array.from(filesList):[],orientationPromises=files.map(file=>ImageCompress.getOrientation(file)),readerPromises=files.map(file=>ImageCompress.fileToDataURL(file));let orientationsResult=[];Promise.all(orientationPromises).then(orientations=>(orientationsResult=orientations,Promise.all(readerPromises))).then(readerResult=>{const resultArray=readerResult.map((parsedFile,index)=>({image:parsedFile.dataUrl,orientation:orientationsResult[index],fileName:parsedFile.fileName}));resolve(multiple?resultArray:resultArray[0])})}).catch(err=>reject(err))}),ImageCompress.fileToDataURL=file=>new Promise((resolve,reject)=>{const reader=new FileReader;reader.onload=e=>{resolve({dataUrl:e.target.result,fileName:file.name})};try{reader.readAsDataURL(file)}catch(e){reject(`ngx-image-compress - probably no file have been selected: ${e}`)}}),ImageCompress.generateUploadInputRenderer=(render,multiple=!0,rejectOnCancel=!1)=>{let lock=!1;return new Promise((resolve,reject)=>{const inputElement=render.createElement("input");render.setStyle(inputElement,"display","none"),render.setProperty(inputElement,"type","file"),render.setProperty(inputElement,"accept","image/*"),multiple&&render.setProperty(inputElement,"multiple","true"),render.listen(inputElement,"click",$event=>{$event.target.value=""}),render.listen(inputElement,"change",$event=>{lock=!0;const files=$event.target.files;resolve(files)}),rejectOnCancel&&window.addEventListener("focus",()=>{setTimeout(()=>{lock||reject(new Error("file upload on blur - no file selected"))},300)},{once:!0}),inputElement.click()})},ImageCompress.generateUploadInputNative=(documentNativeApi,multiple=!0,rejectOnCancel=!1)=>{let lock=!1;return new Promise((resolve,reject)=>{const inputElement=documentNativeApi.createElement("input");inputElement.id="upload-input"+new Date,inputElement.style.display="none",inputElement.setAttribute("type","file"),inputElement.setAttribute("accept","image/*"),multiple&&inputElement.setAttribute("multiple","true"),documentNativeApi.body.appendChild(inputElement),inputElement.addEventListener("change",()=>{lock=!0,resolve(inputElement.files),documentNativeApi.body.removeChild(documentNativeApi.getElementById(inputElement.id))},{once:!0}),rejectOnCancel&&window.addEventListener("focus",()=>{setTimeout(()=>{!lock&&documentNativeApi.getElementById(inputElement.id)&&(reject(new Error("file upload on blur - no file selected")),documentNativeApi.body.removeChild(documentNativeApi.getElementById(inputElement.id)))},300)},{once:!0}),inputElement.click()})},ImageCompress.compress=(imageDataUrlSource,orientation,render,ratio=50,quality=50,maxwidth=0,maxheight=0)=>new Promise(function(resolve,reject){quality/=100,ratio/=100;const sourceImage=new Image;sourceImage.onload=()=>{const canvas=render.createElement("canvas"),ctx=canvas.getContext("2d");if(!ctx)return reject("No canvas context available");let w=sourceImage.naturalWidth,h=sourceImage.naturalHeight;if(!CSS.supports("image-orientation","from-image")&&(orientation===DOC_ORIENTATION.Right||orientation===DOC_ORIENTATION.Left)){const t=w;w=h,h=t}const xratio=maxwidth?maxwidth/w:1,yratio=maxheight?maxheight/h:1;ratio=Math.min(ratio,xratio,yratio),canvas.width=w*ratio,canvas.height=h*ratio;const TO_RADIANS=Math.PI/180;CSS.supports("image-orientation","from-image")||orientation===DOC_ORIENTATION.Up?ctx.drawImage(sourceImage,0,0,canvas.width,canvas.height):orientation===DOC_ORIENTATION.Right?(ctx.save(),ctx.rotate(90*TO_RADIANS),ctx.translate(0,-canvas.width),ctx.drawImage(sourceImage,0,0,canvas.height,canvas.width),ctx.restore()):orientation===DOC_ORIENTATION.Left?(ctx.save(),ctx.rotate(-90*TO_RADIANS),ctx.translate(-canvas.width,0),ctx.drawImage(sourceImage,0,0,canvas.height,canvas.width),ctx.restore()):orientation===DOC_ORIENTATION.Down?(ctx.save(),ctx.rotate(180*TO_RADIANS),ctx.translate(-canvas.width,-canvas.height),ctx.drawImage(sourceImage,0,0,canvas.width,canvas.height),ctx.restore()):ctx.drawImage(sourceImage,0,0,canvas.width,canvas.height);const mime=imageDataUrlSource.substr(5,imageDataUrlSource.split(";")[0].length-5),result=canvas.toDataURL(mime,quality);resolve(result)},sourceImage.onerror=e=>reject(e),sourceImage.src=imageDataUrlSource}),ImageCompress.byteCount=imgString=>encodeURI(imgString).split(/%..|./).length-1,ImageCompress.getImageMaxSize=(maxSizeMb,debugMode,render,rejectOnCancel=!1)=>(0,tslib__WEBPACK_IMPORTED_MODULE_0__.mG)(void 0,void 0,void 0,function*(){const bytesToMB=__name(bytes=>(bytes/1024/1024).toFixed(2),"bytesToMB");debugMode&&console.debug("NgxImageCompress - Opening upload window");const myFile=yield ImageCompress.uploadFile(render,!1,rejectOnCancel);let compressedFile;for(let i=0;i<10;i++){const previousSize=ImageCompress.byteCount(myFile.image);compressedFile=yield ImageCompress.compress(myFile.image,myFile.orientation,render,50,100);const newSize=ImageCompress.byteCount(compressedFile);if(console.debug("NgxImageCompress -","Compression from",bytesToMB(previousSize),"MB to",bytesToMB(newSize),"MB"),newSize>=previousSize)throw 0===i?(debugMode&&console.debug("NgxImageCompress -","File can't be reduced at all - returning the original",bytesToMB(previousSize),"MB large"),Object.assign(Object.assign({},myFile),{image:compressedFile})):(debugMode&&console.debug("NgxImageCompress -","File can't be reduced more - returning the best we can, which is ",bytesToMB(previousSize),"MB large"),Object.assign(Object.assign({},myFile),{image:compressedFile}));if(newSize<1024*maxSizeMb*1024)return debugMode&&console.debug("NgxImageCompress -","Here your file",bytesToMB(newSize),"MB large"),Object.assign(Object.assign({},myFile),{image:compressedFile});if(9===i)throw debugMode&&console.debug("NgxImageCompress -","File can't reach the desired size after",10,"tries. Returning file ",bytesToMB(previousSize),"MB large"),Object.assign(Object.assign({},myFile),{image:compressedFile});debugMode&&console.debug("NgxImageCompress -","Reached",bytesToMB(newSize),"MB large. Trying another time after",i+1,"times"),myFile.image=compressedFile}throw debugMode&&console.debug("NgxImageCompress - Unexpected error"),{}});class NgxImageCompressService{constructor(rendererFactory){this.DOC_ORIENTATION=DOC_ORIENTATION,this.render=rendererFactory.createRenderer(null,null)}byteCount(image){return ImageCompress.byteCount(image)}getOrientation(file){return ImageCompress.getOrientation(file)}uploadFile(){return ImageCompress.uploadFile(this.render,!1)}uploadMultipleFiles(){return ImageCompress.uploadFile(this.render,!0)}uploadFileOrReject(){return ImageCompress.uploadFile(this.render,!1,!0)}uploadMultipleFilesOrReject(){return ImageCompress.uploadFile(this.render,!0,!0)}compressFile(image,orientation,ratio=50,quality=50,maxWidth=0,maxHeight=0){return ImageCompress.compress(image,orientation,this.render,ratio,quality,maxWidth,maxHeight)}uploadAndGetImageWithMaxSize(maxSizeMb=1,debugMode=!1,rejectOnCancel=!1){return ImageCompress.getImageMaxSize(maxSizeMb,debugMode,this.render,rejectOnCancel).then(uploadResponse=>uploadResponse.image).catch(e=>{throw e.image})}uploadAndGetImageWithMaxSizeAndMetas(maxSizeMb=1,debugMode=!1,rejectOnCancel=!1){return ImageCompress.getImageMaxSize(maxSizeMb,debugMode,this.render,rejectOnCancel)}}__name(NgxImageCompressService,"NgxImageCompressService"),NgxImageCompressService.\u0275fac=__name(function(t){return new(t||NgxImageCompressService)(_angular_core__WEBPACK_IMPORTED_MODULE_1__.LFG(_angular_core__WEBPACK_IMPORTED_MODULE_1__.FYo))},"NgxImageCompressService_Factory"),NgxImageCompressService.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_1__.Yz7({token:NgxImageCompressService,factory:NgxImageCompressService.\u0275fac,providedIn:"root"})},83877:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{QG:()=>ImageCropperModule,ap:()=>ImageCropperComponent});var _angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5e3),tslib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(97582),_angular_platform_browser__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(22313),_angular_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(69808);const _c0=["wrapper"],_c1=["sourceImage"];function ImageCropperComponent_img_2_Template(rf,ctx){if(1&rf){const _r5=_angular_core__WEBPACK_IMPORTED_MODULE_0__.EpF();_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"img",4,5),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("load",__name(function(){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r5);const ctx_r4=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r4.imageLoadedInView())},"ImageCropperComponent_img_2_Template_img_load_0_listener"))("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r5);const ctx_r6=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r6.startMove($event,ctx_r6.moveTypes.Drag))},"ImageCropperComponent_img_2_Template_img_mousedown_0_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r5);const ctx_r7=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r7.startMove($event,ctx_r7.moveTypes.Drag))},"ImageCropperComponent_img_2_Template_img_touchstart_0_listener"))("error",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r5);const ctx_r8=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r8.loadImageError($event))},"ImageCropperComponent_img_2_Template_img_error_0_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()}if(2&rf){const ctx_r1=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_0__.Udp("visibility",ctx_r1.imageVisible?"visible":"hidden")("transform",ctx_r1.safeTransformStyle),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ekj("ngx-ic-draggable",!ctx_r1.disabled&&ctx_r1.allowMoveImage),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("src",ctx_r1.safeImgDataUrl,_angular_core__WEBPACK_IMPORTED_MODULE_0__.LSH),_angular_core__WEBPACK_IMPORTED_MODULE_0__.uIk("alt",ctx_r1.imageAltText)}}function ImageCropperComponent_div_4_ng_container_2_Template(rf,ctx){if(1&rf){const _r11=_angular_core__WEBPACK_IMPORTED_MODULE_0__.EpF();_angular_core__WEBPACK_IMPORTED_MODULE_0__.ynx(0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(1,"span",9),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r10=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r10.startMove($event,ctx_r10.moveTypes.Resize,"topleft"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_mousedown_1_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r12=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r12.startMove($event,ctx_r12.moveTypes.Resize,"topleft"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_touchstart_1_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(2,"span",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(3,"span",11),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(4,"span",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(5,"span",12),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r13=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r13.startMove($event,ctx_r13.moveTypes.Resize,"topright"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_mousedown_5_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r14=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r14.startMove($event,ctx_r14.moveTypes.Resize,"topright"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_touchstart_5_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(6,"span",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(7,"span",13),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(8,"span",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(9,"span",14),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r15=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r15.startMove($event,ctx_r15.moveTypes.Resize,"bottomright"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_mousedown_9_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r16=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r16.startMove($event,ctx_r16.moveTypes.Resize,"bottomright"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_touchstart_9_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(10,"span",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(11,"span",15),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(12,"span",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(13,"span",16),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r17=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r17.startMove($event,ctx_r17.moveTypes.Resize,"bottomleft"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_mousedown_13_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r18=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r18.startMove($event,ctx_r18.moveTypes.Resize,"bottomleft"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_touchstart_13_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(14,"span",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(15,"span",17),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(16,"span",10),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(17,"span",18),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r19=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r19.startMove($event,ctx_r19.moveTypes.Resize,"top"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_mousedown_17_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r20=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r20.startMove($event,ctx_r20.moveTypes.Resize,"top"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_touchstart_17_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(18,"span",19),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r21=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r21.startMove($event,ctx_r21.moveTypes.Resize,"right"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_mousedown_18_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r22=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r22.startMove($event,ctx_r22.moveTypes.Resize,"right"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_touchstart_18_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(19,"span",20),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r23=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r23.startMove($event,ctx_r23.moveTypes.Resize,"bottom"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_mousedown_19_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r24=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r24.startMove($event,ctx_r24.moveTypes.Resize,"bottom"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_touchstart_19_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(20,"span",21),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r25=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r25.startMove($event,ctx_r25.moveTypes.Resize,"left"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_mousedown_20_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r11);const ctx_r26=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw(2);return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r26.startMove($event,ctx_r26.moveTypes.Resize,"left"))},"ImageCropperComponent_div_4_ng_container_2_Template_span_touchstart_20_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.BQk()}}function ImageCropperComponent_div_4_Template(rf,ctx){if(1&rf){const _r28=_angular_core__WEBPACK_IMPORTED_MODULE_0__.EpF();_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"div",6),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("keydown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r28);const ctx_r27=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r27.keyboardAccess($event))},"ImageCropperComponent_div_4_Template_div_keydown_0_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(1,"div",7),_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("mousedown",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r28);const ctx_r29=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r29.startMove($event,ctx_r29.moveTypes.Move))},"ImageCropperComponent_div_4_Template_div_mousedown_1_listener"))("touchstart",__name(function($event){_angular_core__WEBPACK_IMPORTED_MODULE_0__.CHM(_r28);const ctx_r30=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();return _angular_core__WEBPACK_IMPORTED_MODULE_0__.KtG(ctx_r30.startMove($event,ctx_r30.moveTypes.Move))},"ImageCropperComponent_div_4_Template_div_touchstart_1_listener")),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA(),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(2,ImageCropperComponent_div_4_ng_container_2_Template,21,0,"ng-container",8),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()}if(2&rf){const ctx_r2=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oxw();_angular_core__WEBPACK_IMPORTED_MODULE_0__.Udp("top",ctx_r2.cropper.y1,"px")("left",ctx_r2.cropper.x1,"px")("width",ctx_r2.cropper.x2-ctx_r2.cropper.x1,"px")("height",ctx_r2.cropper.y2-ctx_r2.cropper.y1,"px")("margin-left","center"===ctx_r2.alignImage?ctx_r2.marginLeft:null)("visibility",ctx_r2.imageVisible?"visible":"hidden"),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ekj("ngx-ic-round",ctx_r2.roundCropper),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",!ctx_r2.hideResizeSquares)}}__name(ImageCropperComponent_img_2_Template,"ImageCropperComponent_img_2_Template"),__name(ImageCropperComponent_div_4_ng_container_2_Template,"ImageCropperComponent_div_4_ng_container_2_Template"),__name(ImageCropperComponent_div_4_Template,"ImageCropperComponent_div_4_Template");class CropperSettings{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(options){Object.keys(options).filter(k=>k in this).forEach(k=>this[k]=options[k]),this.validateOptions()}setOptionsFromChanges(changes){Object.keys(changes).filter(k=>k in this).forEach(k=>this[k]=changes[k].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}var MoveTypes,MoveTypes2;function getPositionForKey(key){switch(key){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";default:return"left"}}function getInvertedPositionForKey(key){switch(key){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";default:return"right"}}function getEventForKey(key,stepSize){switch(key){case"ArrowUp":return{clientX:0,clientY:-1*stepSize};case"ArrowRight":return{clientX:stepSize,clientY:0};case"ArrowDown":return{clientX:0,clientY:stepSize};default:return{clientX:-1*stepSize,clientY:0}}}function resizeCanvas(canvas,width,height){const width_source=canvas.width,height_source=canvas.height,ratio_w=width_source/(width=Math.round(width)),ratio_h=height_source/(height=Math.round(height)),ratio_w_half=Math.ceil(ratio_w/2),ratio_h_half=Math.ceil(ratio_h/2),ctx=canvas.getContext("2d");if(ctx){const img=ctx.getImageData(0,0,width_source,height_source),img2=ctx.createImageData(width,height),data=img.data,data2=img2.data;for(let j=0;j<height;j++)for(let i=0;i<width;i++){const x2=4*(i+j*width),center_y=j*ratio_h;let weight=0,weights=0,weights_alpha=0,gx_r=0,gx_g=0,gx_b=0,gx_a=0;const xx_start=Math.floor(i*ratio_w),yy_start=Math.floor(j*ratio_h);let xx_stop=Math.ceil((i+1)*ratio_w),yy_stop=Math.ceil((j+1)*ratio_h);xx_stop=Math.min(xx_stop,width_source),yy_stop=Math.min(yy_stop,height_source);for(let yy=yy_start;yy<yy_stop;yy++){const dy=Math.abs(center_y-yy)/ratio_h_half,center_x=i*ratio_w,w0=dy*dy;for(let xx=xx_start;xx<xx_stop;xx++){const dx=Math.abs(center_x-xx)/ratio_w_half,w=Math.sqrt(w0+dx*dx);if(w>=1)continue;weight=2*w*w*w-3*w*w+1;const pos_x=4*(xx+yy*width_source);gx_a+=weight*data[pos_x+3],weights_alpha+=weight,data[pos_x+3]<255&&(weight=weight*data[pos_x+3]/250),gx_r+=weight*data[pos_x],gx_g+=weight*data[pos_x+1],gx_b+=weight*data[pos_x+2],weights+=weight}}data2[x2]=gx_r/weights,data2[x2+1]=gx_g/weights,data2[x2+2]=gx_b/weights,data2[x2+3]=gx_a/weights_alpha}canvas.width=width,canvas.height=height,ctx.putImageData(img2,0,0)}}function percentage(percent,totalValue){return percent/100*totalValue}__name(CropperSettings,"CropperSettings"),(MoveTypes2=MoveTypes||(MoveTypes={})).Drag="drag",MoveTypes2.Move="move",MoveTypes2.Resize="resize",MoveTypes2.Pinch="pinch",__name(getPositionForKey,"getPositionForKey"),__name(getInvertedPositionForKey,"getInvertedPositionForKey"),__name(getEventForKey,"getEventForKey"),__name(resizeCanvas,"resizeCanvas"),__name(percentage,"percentage");class CropService{crop(sourceImage,loadedImage,cropper,settings){const imagePosition=this.getImagePosition(sourceImage,loadedImage,cropper,settings),width=imagePosition.x2-imagePosition.x1,height=imagePosition.y2-imagePosition.y1,cropCanvas=document.createElement("canvas");cropCanvas.width=width,cropCanvas.height=height;const ctx=cropCanvas.getContext("2d");if(!ctx)return null;null!=settings.backgroundColor&&(ctx.fillStyle=settings.backgroundColor,ctx.fillRect(0,0,width,height));const scaleX=(settings.transform.scale||1)*(settings.transform.flipH?-1:1),scaleY=(settings.transform.scale||1)*(settings.transform.flipV?-1:1),{translateH,translateV}=this.getCanvasTranslate(sourceImage,loadedImage,settings),transformedImage=loadedImage.transformed;ctx.setTransform(scaleX,0,0,scaleY,transformedImage.size.width/2+translateH,transformedImage.size.height/2+translateV),ctx.translate(-imagePosition.x1/scaleX,-imagePosition.y1/scaleY),ctx.rotate((settings.transform.rotate||0)*Math.PI/180),ctx.drawImage(transformedImage.image,-transformedImage.size.width/2,-transformedImage.size.height/2);const output={width,height,imagePosition,cropperPosition:Object.assign({},cropper)};settings.containWithinAspectRatio&&(output.offsetImagePosition=this.getOffsetImagePosition(sourceImage,loadedImage,cropper,settings));const resizeRatio=this.getResizeRatio(width,height,settings);return 1!==resizeRatio&&(output.width=Math.round(width*resizeRatio),output.height=settings.maintainAspectRatio?Math.round(output.width/settings.aspectRatio):Math.round(height*resizeRatio),resizeCanvas(cropCanvas,output.width,output.height)),output.base64=cropCanvas.toDataURL("image/"+settings.format,this.getQuality(settings)),output}getCanvasTranslate(sourceImage,loadedImage,settings){if("px"===settings.transform.translateUnit){const ratio=this.getRatio(sourceImage,loadedImage);return{translateH:(settings.transform.translateH||0)*ratio,translateV:(settings.transform.translateV||0)*ratio}}return{translateH:settings.transform.translateH?percentage(settings.transform.translateH,loadedImage.transformed.size.width):0,translateV:settings.transform.translateV?percentage(settings.transform.translateV,loadedImage.transformed.size.height):0}}getRatio(sourceImage,loadedImage){const sourceImageElement=sourceImage.nativeElement;return loadedImage.transformed.size.width/sourceImageElement.offsetWidth}getImagePosition(sourceImage,loadedImage,cropper,settings){const ratio=this.getRatio(sourceImage,loadedImage),out={x1:Math.round(cropper.x1*ratio),y1:Math.round(cropper.y1*ratio),x2:Math.round(cropper.x2*ratio),y2:Math.round(cropper.y2*ratio)};return settings.containWithinAspectRatio||(out.x1=Math.max(out.x1,0),out.y1=Math.max(out.y1,0),out.x2=Math.min(out.x2,loadedImage.transformed.size.width),out.y2=Math.min(out.y2,loadedImage.transformed.size.height)),out}getOffsetImagePosition(sourceImage,loadedImage,cropper,settings){const canvasRotation=settings.canvasRotation+loadedImage.exifTransform.rotate,sourceImageElement=sourceImage.nativeElement,ratio=loadedImage.transformed.size.width/sourceImageElement.offsetWidth;let offsetX,offsetY;canvasRotation%2?(offsetX=(loadedImage.transformed.size.width-loadedImage.original.size.height)/2,offsetY=(loadedImage.transformed.size.height-loadedImage.original.size.width)/2):(offsetX=(loadedImage.transformed.size.width-loadedImage.original.size.width)/2,offsetY=(loadedImage.transformed.size.height-loadedImage.original.size.height)/2);const out={x1:Math.round(cropper.x1*ratio)-offsetX,y1:Math.round(cropper.y1*ratio)-offsetY,x2:Math.round(cropper.x2*ratio)-offsetX,y2:Math.round(cropper.y2*ratio)-offsetY};return settings.containWithinAspectRatio||(out.x1=Math.max(out.x1,0),out.y1=Math.max(out.y1,0),out.x2=Math.min(out.x2,loadedImage.transformed.size.width),out.y2=Math.min(out.y2,loadedImage.transformed.size.height)),out}getResizeRatio(width,height,settings){const ratioWidth=settings.resizeToWidth/width,ratioHeight=settings.resizeToHeight/height,ratios=new Array;settings.resizeToWidth>0&&ratios.push(ratioWidth),settings.resizeToHeight>0&&ratios.push(ratioHeight);const result=0===ratios.length?1:Math.min(...ratios);return result>1&&!settings.onlyScaleDown?result:Math.min(result,1)}getQuality(settings){return Math.min(1,Math.max(0,settings.imageQuality/100))}}__name(CropService,"CropService"),CropService.\u0275fac=__name(function(t){return new(t||CropService)},"CropService_Factory"),CropService.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:CropService,factory:CropService.\u0275fac,providedIn:"root"});class CropperPositionService{resetCropperPosition(sourceImage,cropperPosition,settings){if(null==sourceImage||!sourceImage.nativeElement)return;const sourceImageElement=sourceImage.nativeElement;if(settings.cropperStaticHeight&&settings.cropperStaticWidth)cropperPosition.x1=0,cropperPosition.x2=sourceImageElement.offsetWidth>settings.cropperStaticWidth?settings.cropperStaticWidth:sourceImageElement.offsetWidth,cropperPosition.y1=0,cropperPosition.y2=sourceImageElement.offsetHeight>settings.cropperStaticHeight?settings.cropperStaticHeight:sourceImageElement.offsetHeight;else{const cropperWidth=Math.min(settings.cropperScaledMaxWidth,sourceImageElement.offsetWidth),cropperHeight=Math.min(settings.cropperScaledMaxHeight,sourceImageElement.offsetHeight);if(settings.maintainAspectRatio)if(sourceImageElement.offsetWidth/settings.aspectRatio<sourceImageElement.offsetHeight){cropperPosition.x1=0,cropperPosition.x2=cropperWidth;const cropperHeightWithAspectRatio=cropperWidth/settings.aspectRatio;cropperPosition.y1=(sourceImageElement.offsetHeight-cropperHeightWithAspectRatio)/2,cropperPosition.y2=cropperPosition.y1+cropperHeightWithAspectRatio}else{cropperPosition.y1=0,cropperPosition.y2=cropperHeight;const cropperWidthWithAspectRatio=cropperHeight*settings.aspectRatio;cropperPosition.x1=(sourceImageElement.offsetWidth-cropperWidthWithAspectRatio)/2,cropperPosition.x2=cropperPosition.x1+cropperWidthWithAspectRatio}else cropperPosition.x1=0,cropperPosition.x2=cropperWidth,cropperPosition.y1=0,cropperPosition.y2=cropperHeight}}move(event,moveStart,cropperPosition){const diffX=this.getClientX(event)-moveStart.clientX,diffY=this.getClientY(event)-moveStart.clientY;cropperPosition.x1=moveStart.x1+diffX,cropperPosition.y1=moveStart.y1+diffY,cropperPosition.x2=moveStart.x2+diffX,cropperPosition.y2=moveStart.y2+diffY}resize(event,moveStart,cropperPosition,maxSize,settings){const moveX=this.getClientX(event)-moveStart.clientX,moveY=this.getClientY(event)-moveStart.clientY;switch(moveStart.position){case"left":cropperPosition.x1=Math.min(Math.max(moveStart.x1+moveX,cropperPosition.x2-settings.cropperScaledMaxWidth),cropperPosition.x2-settings.cropperScaledMinWidth);break;case"topleft":cropperPosition.x1=Math.min(Math.max(moveStart.x1+moveX,cropperPosition.x2-settings.cropperScaledMaxWidth),cropperPosition.x2-settings.cropperScaledMinWidth),cropperPosition.y1=Math.min(Math.max(moveStart.y1+moveY,cropperPosition.y2-settings.cropperScaledMaxHeight),cropperPosition.y2-settings.cropperScaledMinHeight);break;case"top":cropperPosition.y1=Math.min(Math.max(moveStart.y1+moveY,cropperPosition.y2-settings.cropperScaledMaxHeight),cropperPosition.y2-settings.cropperScaledMinHeight);break;case"topright":cropperPosition.x2=Math.max(Math.min(moveStart.x2+moveX,cropperPosition.x1+settings.cropperScaledMaxWidth),cropperPosition.x1+settings.cropperScaledMinWidth),cropperPosition.y1=Math.min(Math.max(moveStart.y1+moveY,cropperPosition.y2-settings.cropperScaledMaxHeight),cropperPosition.y2-settings.cropperScaledMinHeight);break;case"right":cropperPosition.x2=Math.max(Math.min(moveStart.x2+moveX,cropperPosition.x1+settings.cropperScaledMaxWidth),cropperPosition.x1+settings.cropperScaledMinWidth);break;case"bottomright":cropperPosition.x2=Math.max(Math.min(moveStart.x2+moveX,cropperPosition.x1+settings.cropperScaledMaxWidth),cropperPosition.x1+settings.cropperScaledMinWidth),cropperPosition.y2=Math.max(Math.min(moveStart.y2+moveY,cropperPosition.y1+settings.cropperScaledMaxHeight),cropperPosition.y1+settings.cropperScaledMinHeight);break;case"bottom":cropperPosition.y2=Math.max(Math.min(moveStart.y2+moveY,cropperPosition.y1+settings.cropperScaledMaxHeight),cropperPosition.y1+settings.cropperScaledMinHeight);break;case"bottomleft":cropperPosition.x1=Math.min(Math.max(moveStart.x1+moveX,cropperPosition.x2-settings.cropperScaledMaxWidth),cropperPosition.x2-settings.cropperScaledMinWidth),cropperPosition.y2=Math.max(Math.min(moveStart.y2+moveY,cropperPosition.y1+settings.cropperScaledMaxHeight),cropperPosition.y1+settings.cropperScaledMinHeight);break;case"center":const scale=event.scale,newWidth=Math.min(Math.max(settings.cropperScaledMinWidth,Math.abs(moveStart.x2-moveStart.x1)*scale),settings.cropperScaledMaxWidth),newHeight=Math.min(Math.max(settings.cropperScaledMinHeight,Math.abs(moveStart.y2-moveStart.y1)*scale),settings.cropperScaledMaxHeight);cropperPosition.x1=moveStart.clientX-newWidth/2,cropperPosition.x2=moveStart.clientX+newWidth/2,cropperPosition.y1=moveStart.clientY-newHeight/2,cropperPosition.y2=moveStart.clientY+newHeight/2,cropperPosition.x1<0?(cropperPosition.x2-=cropperPosition.x1,cropperPosition.x1=0):cropperPosition.x2>maxSize.width&&(cropperPosition.x1-=cropperPosition.x2-maxSize.width,cropperPosition.x2=maxSize.width),cropperPosition.y1<0?(cropperPosition.y2-=cropperPosition.y1,cropperPosition.y1=0):cropperPosition.y2>maxSize.height&&(cropperPosition.y1-=cropperPosition.y2-maxSize.height,cropperPosition.y2=maxSize.height)}settings.maintainAspectRatio&&this.checkAspectRatio(moveStart.position,cropperPosition,maxSize,settings)}checkAspectRatio(position,cropperPosition,maxSize,settings){let overflowX=0,overflowY=0;switch(position){case"top":cropperPosition.x2=cropperPosition.x1+(cropperPosition.y2-cropperPosition.y1)*settings.aspectRatio,overflowX=Math.max(cropperPosition.x2-maxSize.width,0),overflowY=Math.max(0-cropperPosition.y1,0),(overflowX>0||overflowY>0)&&(cropperPosition.x2-=overflowY*settings.aspectRatio>overflowX?overflowY*settings.aspectRatio:overflowX,cropperPosition.y1+=overflowY*settings.aspectRatio>overflowX?overflowY:overflowX/settings.aspectRatio);break;case"bottom":cropperPosition.x2=cropperPosition.x1+(cropperPosition.y2-cropperPosition.y1)*settings.aspectRatio,overflowX=Math.max(cropperPosition.x2-maxSize.width,0),overflowY=Math.max(cropperPosition.y2-maxSize.height,0),(overflowX>0||overflowY>0)&&(cropperPosition.x2-=overflowY*settings.aspectRatio>overflowX?overflowY*settings.aspectRatio:overflowX,cropperPosition.y2-=overflowY*settings.aspectRatio>overflowX?overflowY:overflowX/settings.aspectRatio);break;case"topleft":cropperPosition.y1=cropperPosition.y2-(cropperPosition.x2-cropperPosition.x1)/settings.aspectRatio,overflowX=Math.max(0-cropperPosition.x1,0),overflowY=Math.max(0-cropperPosition.y1,0),(overflowX>0||overflowY>0)&&(cropperPosition.x1+=overflowY*settings.aspectRatio>overflowX?overflowY*settings.aspectRatio:overflowX,cropperPosition.y1+=overflowY*settings.aspectRatio>overflowX?overflowY:overflowX/settings.aspectRatio);break;case"topright":cropperPosition.y1=cropperPosition.y2-(cropperPosition.x2-cropperPosition.x1)/settings.aspectRatio,overflowX=Math.max(cropperPosition.x2-maxSize.width,0),overflowY=Math.max(0-cropperPosition.y1,0),(overflowX>0||overflowY>0)&&(cropperPosition.x2-=overflowY*settings.aspectRatio>overflowX?overflowY*settings.aspectRatio:overflowX,cropperPosition.y1+=overflowY*settings.aspectRatio>overflowX?overflowY:overflowX/settings.aspectRatio);break;case"right":case"bottomright":cropperPosition.y2=cropperPosition.y1+(cropperPosition.x2-cropperPosition.x1)/settings.aspectRatio,overflowX=Math.max(cropperPosition.x2-maxSize.width,0),overflowY=Math.max(cropperPosition.y2-maxSize.height,0),(overflowX>0||overflowY>0)&&(cropperPosition.x2-=overflowY*settings.aspectRatio>overflowX?overflowY*settings.aspectRatio:overflowX,cropperPosition.y2-=overflowY*settings.aspectRatio>overflowX?overflowY:overflowX/settings.aspectRatio);break;case"left":case"bottomleft":cropperPosition.y2=cropperPosition.y1+(cropperPosition.x2-cropperPosition.x1)/settings.aspectRatio,overflowX=Math.max(0-cropperPosition.x1,0),overflowY=Math.max(cropperPosition.y2-maxSize.height,0),(overflowX>0||overflowY>0)&&(cropperPosition.x1+=overflowY*settings.aspectRatio>overflowX?overflowY*settings.aspectRatio:overflowX,cropperPosition.y2-=overflowY*settings.aspectRatio>overflowX?overflowY:overflowX/settings.aspectRatio);break;case"center":cropperPosition.x2=cropperPosition.x1+(cropperPosition.y2-cropperPosition.y1)*settings.aspectRatio,cropperPosition.y2=cropperPosition.y1+(cropperPosition.x2-cropperPosition.x1)/settings.aspectRatio;const overflowX1=Math.max(0-cropperPosition.x1,0),overflowX2=Math.max(cropperPosition.x2-maxSize.width,0),overflowY1=Math.max(cropperPosition.y2-maxSize.height,0),overflowY2=Math.max(0-cropperPosition.y1,0);(overflowX1>0||overflowX2>0||overflowY1>0||overflowY2>0)&&(cropperPosition.x1+=overflowY1*settings.aspectRatio>overflowX1?overflowY1*settings.aspectRatio:overflowX1,cropperPosition.x2-=overflowY2*settings.aspectRatio>overflowX2?overflowY2*settings.aspectRatio:overflowX2,cropperPosition.y1+=overflowY2*settings.aspectRatio>overflowX2?overflowY2:overflowX2/settings.aspectRatio,cropperPosition.y2-=overflowY1*settings.aspectRatio>overflowX1?overflowY1:overflowX1/settings.aspectRatio)}}getClientX(event){var _a;return(null===(_a=event.touches)||void 0===_a?void 0:_a[0].clientX)||event.clientX||0}getClientY(event){var _a;return(null===(_a=event.touches)||void 0===_a?void 0:_a[0].clientY)||event.clientY||0}}__name(CropperPositionService,"CropperPositionService"),CropperPositionService.\u0275fac=__name(function(t){return new(t||CropperPositionService)},"CropperPositionService_Factory"),CropperPositionService.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:CropperPositionService,factory:CropperPositionService.\u0275fac,providedIn:"root"});function supportsAutomaticRotation(){return new Promise(resolve=>{const img=new Image;img.onload=()=>{const supported=1===img.width&&2===img.height;resolve(supported)},img.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}function getTransformationsFromExifData(exifRotationOrBase64Image){switch("string"==typeof exifRotationOrBase64Image&&(exifRotationOrBase64Image=getExifRotation(exifRotationOrBase64Image)),exifRotationOrBase64Image){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}function getExifRotation(imageBase64){const view=new DataView(base64ToArrayBuffer(imageBase64));if(65496!==view.getUint16(0,!1))return-2;const length=view.byteLength;let offset=2;for(;offset<length;){if(view.getUint16(offset+2,!1)<=8)return-1;const marker=view.getUint16(offset,!1);if(offset+=2,65505==marker){if(1165519206!==view.getUint32(offset+=2,!1))return-1;const little=18761==view.getUint16(offset+=6,!1);offset+=view.getUint32(offset+4,little);const tags=view.getUint16(offset,little);offset+=2;for(let i=0;i<tags;i++)if(274==view.getUint16(offset+12*i,little))return view.getUint16(offset+12*i+8,little)}else{if(65280!=(65280&marker))break;offset+=view.getUint16(offset,!1)}}return-1}function base64ToArrayBuffer(imageBase64){imageBase64=imageBase64.replace(/^data\:([^\;]+)\;base64,/gim,"");const binaryString=atob(imageBase64),len=binaryString.length,bytes=new Uint8Array(len);for(let i=0;i<len;i++)bytes[i]=binaryString.charCodeAt(i);return bytes.buffer}__name(supportsAutomaticRotation,"supportsAutomaticRotation"),__name(getTransformationsFromExifData,"getTransformationsFromExifData"),__name(getExifRotation,"getExifRotation"),__name(base64ToArrayBuffer,"base64ToArrayBuffer");class LoadImageService{constructor(){this.autoRotateSupported=supportsAutomaticRotation()}loadImageFile(file,cropperSettings){return new Promise((resolve,reject)=>{const fileReader=new FileReader;fileReader.onload=event=>{this.loadImage(event.target.result,file.type,cropperSettings).then(resolve).catch(reject)},fileReader.readAsDataURL(file)})}loadImage(imageBase64,imageType,cropperSettings){return this.isValidImageType(imageType)?this.loadBase64Image(imageBase64,cropperSettings):Promise.reject(new Error("Invalid image type"))}isValidImageType(type){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(type)}loadImageFromURL(url,cropperSettings){return new Promise((resolve,reject)=>{const img=new Image;img.onerror=()=>reject,img.onload=()=>{const canvas=document.createElement("canvas"),context=canvas.getContext("2d");canvas.width=img.width,canvas.height=img.height,null==context||context.drawImage(img,0,0),this.loadBase64Image(canvas.toDataURL(),cropperSettings).then(resolve)},img.crossOrigin="anonymous",img.src=url})}loadBase64Image(imageBase64,cropperSettings){return new Promise((resolve,reject)=>{const originalImage=new Image;originalImage.onload=()=>resolve({originalImage,originalBase64:imageBase64}),originalImage.onerror=reject,originalImage.src=imageBase64}).then(res=>this.transformImageBase64(res,cropperSettings))}transformImageBase64(res,cropperSettings){return(0,tslib__WEBPACK_IMPORTED_MODULE_1__.mG)(this,void 0,void 0,function*(){const autoRotate=yield this.autoRotateSupported,exifTransform=yield getTransformationsFromExifData(autoRotate?-1:res.originalBase64);if(!res.originalImage||!res.originalImage.complete)return Promise.reject(new Error("No image loaded"));const loadedImage={original:{base64:res.originalBase64,image:res.originalImage,size:{width:res.originalImage.naturalWidth,height:res.originalImage.naturalHeight}},exifTransform};return this.transformLoadedImage(loadedImage,cropperSettings)})}transformLoadedImage(loadedImage,cropperSettings){return(0,tslib__WEBPACK_IMPORTED_MODULE_1__.mG)(this,void 0,void 0,function*(){const canvasRotation=cropperSettings.canvasRotation+loadedImage.exifTransform.rotate,originalSize={width:loadedImage.original.image.naturalWidth,height:loadedImage.original.image.naturalHeight};if(0===canvasRotation&&!loadedImage.exifTransform.flip&&!cropperSettings.containWithinAspectRatio)return{original:{base64:loadedImage.original.base64,image:loadedImage.original.image,size:Object.assign({},originalSize)},transformed:{base64:loadedImage.original.base64,image:loadedImage.original.image,size:Object.assign({},originalSize)},exifTransform:loadedImage.exifTransform};const transformedSize=this.getTransformedSize(originalSize,loadedImage.exifTransform,cropperSettings),canvas=document.createElement("canvas");canvas.width=transformedSize.width,canvas.height=transformedSize.height;const ctx=canvas.getContext("2d");null==ctx||ctx.setTransform(loadedImage.exifTransform.flip?-1:1,0,0,1,canvas.width/2,canvas.height/2),null==ctx||ctx.rotate(Math.PI*(canvasRotation/2)),null==ctx||ctx.drawImage(loadedImage.original.image,-originalSize.width/2,-originalSize.height/2);const transformedBase64=canvas.toDataURL(),transformedImage=yield this.loadImageFromBase64(transformedBase64);return{original:{base64:loadedImage.original.base64,image:loadedImage.original.image,size:Object.assign({},originalSize)},transformed:{base64:transformedBase64,image:transformedImage,size:{width:transformedImage.width,height:transformedImage.height}},exifTransform:loadedImage.exifTransform}})}loadImageFromBase64(imageBase64){return new Promise((resolve,reject)=>{const image=new Image;image.onload=()=>resolve(image),image.onerror=reject,image.src=imageBase64})}getTransformedSize(originalSize,exifTransform,cropperSettings){const canvasRotation=cropperSettings.canvasRotation+exifTransform.rotate;if(cropperSettings.containWithinAspectRatio){if(canvasRotation%2){const minWidthToContain=originalSize.width*cropperSettings.aspectRatio,minHeightToContain=originalSize.height/cropperSettings.aspectRatio;return{width:Math.max(originalSize.height,minWidthToContain),height:Math.max(originalSize.width,minHeightToContain)}}{const minWidthToContain=originalSize.height*cropperSettings.aspectRatio,minHeightToContain=originalSize.width/cropperSettings.aspectRatio;return{width:Math.max(originalSize.width,minWidthToContain),height:Math.max(originalSize.height,minHeightToContain)}}}return canvasRotation%2?{height:originalSize.width,width:originalSize.height}:{width:originalSize.width,height:originalSize.height}}}__name(LoadImageService,"LoadImageService"),LoadImageService.\u0275fac=__name(function(t){return new(t||LoadImageService)},"LoadImageService_Factory"),LoadImageService.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Yz7({token:LoadImageService,factory:LoadImageService.\u0275fac,providedIn:"root"});class ImageCropperComponent{constructor(cropService,cropperPositionService,loadImageService,sanitizer,cd){this.cropService=cropService,this.cropperPositionService=cropperPositionService,this.loadImageService=loadImageService,this.sanitizer=sanitizer,this.cd=cd,this.Hammer=(null==window?void 0:window.Hammer)||null,this.settings=new CropperSettings,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.marginLeft="0px",this.maxSize={width:0,height:0},this.moveTypes=MoveTypes,this.imageVisible=!1,this.format=this.settings.format,this.transform={},this.maintainAspectRatio=this.settings.maintainAspectRatio,this.aspectRatio=this.settings.aspectRatio,this.resetCropOnAspectRatioChange=this.settings.resetCropOnAspectRatioChange,this.resizeToWidth=this.settings.resizeToWidth,this.resizeToHeight=this.settings.resizeToHeight,this.cropperMinWidth=this.settings.cropperMinWidth,this.cropperMinHeight=this.settings.cropperMinHeight,this.cropperMaxHeight=this.settings.cropperMaxHeight,this.cropperMaxWidth=this.settings.cropperMaxWidth,this.cropperStaticWidth=this.settings.cropperStaticWidth,this.cropperStaticHeight=this.settings.cropperStaticHeight,this.canvasRotation=this.settings.canvasRotation,this.initialStepSize=this.settings.initialStepSize,this.roundCropper=this.settings.roundCropper,this.onlyScaleDown=this.settings.onlyScaleDown,this.imageQuality=this.settings.imageQuality,this.autoCrop=this.settings.autoCrop,this.backgroundColor=this.settings.backgroundColor,this.containWithinAspectRatio=this.settings.containWithinAspectRatio,this.hideResizeSquares=this.settings.hideResizeSquares,this.allowMoveImage=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage=this.settings.alignImage,this.disabled=!1,this.hidden=!1,this.imageCropped=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.vpe,this.startCropImage=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.vpe,this.imageLoaded=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.vpe,this.cropperReady=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.vpe,this.loadImageFailed=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.vpe,this.transformChange=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.vpe,this.reset()}ngOnChanges(changes){var _a;this.onChangesUpdateSettings(changes),this.onChangesInputImage(changes),(null===(_a=this.loadedImage)||void 0===_a?void 0:_a.original.image.complete)&&(changes.containWithinAspectRatio||changes.canvasRotation)&&this.loadImageService.transformLoadedImage(this.loadedImage,this.settings).then(res=>this.setLoadedImage(res)).catch(err=>this.loadImageError(err)),(changes.cropper||changes.maintainAspectRatio||changes.aspectRatio)&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),!this.maintainAspectRatio||!this.resetCropOnAspectRatioChange&&this.aspectRatioIsCorrect()||!changes.maintainAspectRatio&&!changes.aspectRatio?changes.cropper&&(this.checkCropperPosition(!1),this.doAutoCrop()):this.resetCropperPosition(),this.cd.markForCheck()),changes.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop(),this.cd.markForCheck()),changes.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesUpdateSettings(changes){this.settings.setOptionsFromChanges(changes),this.settings.cropperStaticHeight&&this.settings.cropperStaticWidth&&this.settings.setOptions({hideResizeSquares:!0,cropperMinWidth:this.settings.cropperStaticWidth,cropperMinHeight:this.settings.cropperStaticHeight,cropperMaxHeight:this.settings.cropperStaticHeight,cropperMaxWidth:this.settings.cropperStaticWidth,maintainAspectRatio:!1})}onChangesInputImage(changes){(changes.imageChangedEvent||changes.imageURL||changes.imageBase64||changes.imageFile)&&this.reset(),changes.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),changes.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),changes.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),changes.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){var _a,_b,_c;return(null===(_c=null===(_b=null===(_a=this.imageChangedEvent)||void 0===_a?void 0:_a.target)||void 0===_b?void 0:_b.files)||void 0===_c?void 0:_c.length)>0}setCssTransform(){var _a;const translateUnit=(null===(_a=this.transform)||void 0===_a?void 0:_a.translateUnit)||"%";this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle(`translate(${this.transform.translateH||0}${translateUnit}, ${this.transform.translateV||0}${translateUnit}) scaleX(`+(this.transform.scale||1)*(this.transform.flipH?-1:1)+") scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+") rotate("+(this.transform.rotate||0)+"deg)")}ngOnInit(){this.settings.stepSize=this.initialStepSize,this.activatePinchGesture()}reset(){this.imageVisible=!1,this.loadedImage=void 0,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(file){this.loadImageService.loadImageFile(file,this.settings).then(res=>this.setLoadedImage(res)).catch(err=>this.loadImageError(err))}loadBase64Image(imageBase64){this.loadImageService.loadBase64Image(imageBase64,this.settings).then(res=>this.setLoadedImage(res)).catch(err=>this.loadImageError(err))}loadImageFromURL(url){this.loadImageService.loadImageFromURL(url,this.settings).then(res=>this.setLoadedImage(res)).catch(err=>this.loadImageError(err))}setLoadedImage(loadedImage){this.loadedImage=loadedImage,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(loadedImage.transformed.base64),this.cd.markForCheck()}loadImageError(error){console.error(error),this.loadImageFailed.emit()}imageLoadedInView(){null!=this.loadedImage&&(this.imageLoaded.emit(this.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.resetCropperPosition(),this.cropperReady.emit(Object.assign({},this.maxSize)),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){var _a,_b;return(null===(_b=null===(_a=this.sourceImage)||void 0===_a?void 0:_a.nativeElement)||void 0===_b?void 0:_b.offsetWidth)>0}onResize(){!this.loadedImage||(this.hidden?this.resizedWhileHidden=!0:(this.resizeCropperPosition(),this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()))}activatePinchGesture(){if(this.Hammer){const hammer=new this.Hammer(this.wrapper.nativeElement);hammer.get("pinch").set({enable:!0}),hammer.on("pinchmove",this.onPinch.bind(this)),hammer.on("pinchend",this.pinchStop.bind(this)),hammer.on("pinchstart",this.startPinch.bind(this))}else(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.X6Q)()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")}resizeCropperPosition(){const sourceImageElement=this.sourceImage.nativeElement;(this.maxSize.width!==sourceImageElement.offsetWidth||this.maxSize.height!==sourceImageElement.offsetHeight)&&(this.cropper.x1=this.cropper.x1*sourceImageElement.offsetWidth/this.maxSize.width,this.cropper.x2=this.cropper.x2*sourceImageElement.offsetWidth/this.maxSize.width,this.cropper.y1=this.cropper.y1*sourceImageElement.offsetHeight/this.maxSize.height,this.cropper.y2=this.cropper.y2*sourceImageElement.offsetHeight/this.maxSize.height)}resetCropperPosition(){this.cropperPositionService.resetCropperPosition(this.sourceImage,this.cropper,this.settings),this.doAutoCrop(),this.imageVisible=!0}keyboardAccess(event){this.changeKeyboardStepSize(event),this.keyboardMoveCropper(event)}changeKeyboardStepSize(event){const key=+event.key;key>=1&&key<=9&&(this.settings.stepSize=key)}keyboardMoveCropper(event){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(event.key))return;const moveType=event.shiftKey?MoveTypes.Resize:MoveTypes.Move,position=event.altKey?getInvertedPositionForKey(event.key):getPositionForKey(event.key),moveEvent=getEventForKey(event.key,this.settings.stepSize);event.preventDefault(),event.stopPropagation(),this.startMove({clientX:0,clientY:0},moveType,position),this.moveImg(moveEvent),this.moveStop()}startMove(event,moveType,position=null){var _a,_b;this.disabled||(null===(_a=this.moveStart)||void 0===_a?void 0:_a.active)&&(null===(_b=this.moveStart)||void 0===_b?void 0:_b.type)===MoveTypes.Pinch||moveType===MoveTypes.Drag&&!this.allowMoveImage||(event.preventDefault&&event.preventDefault(),this.moveStart=Object.assign({active:!0,type:moveType,position,transform:Object.assign({},this.transform),clientX:this.cropperPositionService.getClientX(event),clientY:this.cropperPositionService.getClientY(event)},this.cropper))}startPinch(event){!this.safeImgDataUrl||(event.preventDefault&&event.preventDefault(),this.moveStart=Object.assign({active:!0,type:MoveTypes.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2},this.cropper))}moveImg(event){var _a,_b;if(this.moveStart.active){if(event.stopPropagation&&event.stopPropagation(),event.preventDefault&&event.preventDefault(),this.moveStart.type===MoveTypes.Move)this.cropperPositionService.move(event,this.moveStart,this.cropper),this.checkCropperPosition(!0);else if(this.moveStart.type===MoveTypes.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.cropperPositionService.resize(event,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1);else if(this.moveStart.type===MoveTypes.Drag){const diffX=this.cropperPositionService.getClientX(event)-this.moveStart.clientX,diffY=this.cropperPositionService.getClientY(event)-this.moveStart.clientY;this.transform=Object.assign(Object.assign({},this.transform),{translateH:((null===(_a=this.moveStart.transform)||void 0===_a?void 0:_a.translateH)||0)+diffX,translateV:((null===(_b=this.moveStart.transform)||void 0===_b?void 0:_b.translateV)||0)+diffY}),this.setCssTransform()}this.cd.detectChanges()}}onPinch(event){this.moveStart.active&&(event.stopPropagation&&event.stopPropagation(),event.preventDefault&&event.preventDefault(),this.moveStart.type===MoveTypes.Pinch&&(this.cropperPositionService.resize(event,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.detectChanges())}setMaxSize(){if(this.sourceImage){const sourceImageElement=this.sourceImage.nativeElement;this.maxSize.width=sourceImageElement.offsetWidth,this.maxSize.height=sourceImageElement.offsetHeight,this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){var _a,_b;null!==(_b=null===(_a=this.loadedImage)||void 0===_a?void 0:_a.transformed)&&void 0!==_b&&_b.image?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.settings.cropperScaledMinWidth=20,this.settings.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.settings.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.loadedImage.transformed.image.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.maintainAspectRatio?this.settings.cropperScaledMinHeight=Math.max(20,this.settings.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?this.settings.cropperScaledMinHeight=Math.max(20,this.cropperMinHeight/this.loadedImage.transformed.image.height*this.maxSize.height):this.settings.cropperScaledMinHeight=20}setCropperScaledMaxSize(){var _a,_b;if(null!==(_b=null===(_a=this.loadedImage)||void 0===_a?void 0:_a.transformed)&&void 0!==_b&&_b.image){const ratio=this.loadedImage.transformed.size.width/this.maxSize.width;this.settings.cropperScaledMaxWidth=this.cropperMaxWidth>20?this.cropperMaxWidth/ratio:this.maxSize.width,this.settings.cropperScaledMaxHeight=this.cropperMaxHeight>20?this.cropperMaxHeight/ratio:this.maxSize.height,this.maintainAspectRatio&&(this.settings.cropperScaledMaxWidth>this.settings.cropperScaledMaxHeight*this.aspectRatio?this.settings.cropperScaledMaxWidth=this.settings.cropperScaledMaxHeight*this.aspectRatio:this.settings.cropperScaledMaxWidth<this.settings.cropperScaledMaxHeight*this.aspectRatio&&(this.settings.cropperScaledMaxHeight=this.settings.cropperScaledMaxWidth/this.aspectRatio))}else this.settings.cropperScaledMaxWidth=this.maxSize.width,this.settings.cropperScaledMaxHeight=this.maxSize.height}checkCropperPosition(maintainSize=!1){this.cropper.x1<0&&(this.cropper.x2-=maintainSize?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=maintainSize?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=maintainSize?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=maintainSize?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}moveStop(){var _a;this.moveStart.active&&(this.moveStart.active=!1,(null===(_a=this.moveStart)||void 0===_a?void 0:_a.type)===MoveTypes.Drag?this.transformChange.emit(this.transform):this.doAutoCrop())}pinchStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}doAutoCrop(){this.autoCrop&&this.crop()}crop(){var _a,_b;if(null!=(null===(_b=null===(_a=this.loadedImage)||void 0===_a?void 0:_a.transformed)||void 0===_b?void 0:_b.image)){this.startCropImage.emit();const output=this.cropService.crop(this.sourceImage,this.loadedImage,this.cropper,this.settings);return null!=output&&this.imageCropped.emit(output),output}return null}aspectRatioIsCorrect(){return(this.cropper.x2-this.cropper.x1)/(this.cropper.y2-this.cropper.y1)===this.aspectRatio}}__name(ImageCropperComponent,"ImageCropperComponent"),ImageCropperComponent.\u0275fac=__name(function(t){return new(t||ImageCropperComponent)(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(CropService),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(CropperPositionService),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(LoadImageService),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(_angular_platform_browser__WEBPACK_IMPORTED_MODULE_2__.H7),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Y36(_angular_core__WEBPACK_IMPORTED_MODULE_0__.sBO))},"ImageCropperComponent_Factory"),ImageCropperComponent.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_0__.Xpm({type:ImageCropperComponent,selectors:[["image-cropper"]],viewQuery:__name(function(rf,ctx){if(1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Gf(_c0,7),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Gf(_c1,5)),2&rf){let _t;_angular_core__WEBPACK_IMPORTED_MODULE_0__.iGM(_t=_angular_core__WEBPACK_IMPORTED_MODULE_0__.CRH())&&(ctx.wrapper=_t.first),_angular_core__WEBPACK_IMPORTED_MODULE_0__.iGM(_t=_angular_core__WEBPACK_IMPORTED_MODULE_0__.CRH())&&(ctx.sourceImage=_t.first)}},"ImageCropperComponent_Query"),hostVars:6,hostBindings:__name(function(rf,ctx){1&rf&&_angular_core__WEBPACK_IMPORTED_MODULE_0__.NdJ("resize",__name(function(){return ctx.onResize()},"ImageCropperComponent_resize_HostBindingHandler"),!1,_angular_core__WEBPACK_IMPORTED_MODULE_0__.Jf7)("mousemove",__name(function($event){return ctx.moveImg($event)},"ImageCropperComponent_mousemove_HostBindingHandler"),!1,_angular_core__WEBPACK_IMPORTED_MODULE_0__.evT)("touchmove",__name(function($event){return ctx.moveImg($event)},"ImageCropperComponent_touchmove_HostBindingHandler"),!1,_angular_core__WEBPACK_IMPORTED_MODULE_0__.evT)("mouseup",__name(function(){return ctx.moveStop()},"ImageCropperComponent_mouseup_HostBindingHandler"),!1,_angular_core__WEBPACK_IMPORTED_MODULE_0__.evT)("touchend",__name(function(){return ctx.moveStop()},"ImageCropperComponent_touchend_HostBindingHandler"),!1,_angular_core__WEBPACK_IMPORTED_MODULE_0__.evT),2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Udp("text-align",ctx.alignImage),_angular_core__WEBPACK_IMPORTED_MODULE_0__.ekj("disabled",ctx.disabled)("ngx-ix-hidden",ctx.hidden))},"ImageCropperComponent_HostBindings"),inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",format:"format",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange"},features:[_angular_core__WEBPACK_IMPORTED_MODULE_0__.TTD],decls:5,vars:10,consts:[["wrapper",""],["class","ngx-ic-source-image",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],[1,"ngx-ic-source-image",3,"src","load","mousedown","touchstart","error"],["sourceImage",""],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],[1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],[1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],[1,"ngx-ic-resize","ngx-ic-top"],[1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right"],[1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom"],[1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left"],[1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"]],template:__name(function(rf,ctx){1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.TgZ(0,"div",null,0),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(2,ImageCropperComponent_img_2_Template,2,8,"img",1),_angular_core__WEBPACK_IMPORTED_MODULE_0__._UZ(3,"div",2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.YNc(4,ImageCropperComponent_div_4_Template,3,15,"div",3),_angular_core__WEBPACK_IMPORTED_MODULE_0__.qZA()),2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_0__.Udp("background",ctx.imageVisible&&ctx.backgroundColor),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(2),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",ctx.safeImgDataUrl),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Udp("width",ctx.maxSize.width,"px")("height",ctx.maxSize.height,"px")("margin-left","center"===ctx.alignImage?ctx.marginLeft:null),_angular_core__WEBPACK_IMPORTED_MODULE_0__.xp6(1),_angular_core__WEBPACK_IMPORTED_MODULE_0__.Q6J("ngIf",ctx.imageVisible))},"ImageCropperComponent_Template"),dependencies:[_angular_common__WEBPACK_IMPORTED_MODULE_3__.O5],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:transparent;outline:rgba(255,255,255,.3) solid 100vw;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;background:#53535C;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw #ffffff4d;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh #ffffff4d;box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ix-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0});class ImageCropperModule{}__name(ImageCropperModule,"ImageCropperModule"),ImageCropperModule.\u0275fac=__name(function(t){return new(t||ImageCropperModule)},"ImageCropperModule_Factory"),ImageCropperModule.\u0275mod=_angular_core__WEBPACK_IMPORTED_MODULE_0__.oAB({type:ImageCropperModule}),ImageCropperModule.\u0275inj=_angular_core__WEBPACK_IMPORTED_MODULE_0__.cJS({imports:[[_angular_common__WEBPACK_IMPORTED_MODULE_3__.ez]]}),__name(function base64ToFile(base64Image){const split=base64Image.split(","),type=split[0].replace("data:","").replace(";base64",""),byteString=atob(split[1]),ab=new ArrayBuffer(byteString.length),ia=new Uint8Array(ab);for(let i=0;i<byteString.length;i+=1)ia[i]=byteString.charCodeAt(i);return new Blob([ab],{type})},"base64ToFile")}};