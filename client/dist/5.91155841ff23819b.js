"use strict";(self.webpackChunkCityInfo=self.webpackChunkCityInfo||[]).push([[5],{4005:(j,L,C)=>{C.r(L),C.d(L,{DashboardModule:()=>R});var H=C(4968),r=C(5407),M=C(8274),W=C(5453);const _=[{path:"",redirectTo:"superadmin",pathMatch:"full"},{path:"uploads",component:(()=>{class h{constructor(){}ngOnInit(){}}return h.\u0275fac=function(f){return new(f||h)},h.\u0275cmp=M.Xpm({type:h,selectors:[["app-uploads"]],decls:2,vars:0,template:function(f,z){1&f&&(M.TgZ(0,"p"),M._uU(1,"uploads works!"),M.qZA())},styles:[""]}),h})()},{path:"superadmin",canActivate:[(()=>{class h{constructor(f,z){this.router=f,this.helpService=z}canActivate(){return this.helpService.getUserType()==r.F.superadmin||(this.router.navigate(["/dashboard/user"]),!1)}}return h.\u0275fac=function(f){return new(f||h)(M.LFG(H.F0),M.LFG(W.s))},h.\u0275prov=M.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()],loadChildren:()=>Promise.all([C.e(431),C.e(108)]).then(C.bind(C,108)).then(h=>h.SuperadminModule)},{path:"user",canActivate:[(()=>{class h{constructor(f,z){this.router=f,this.helpService=z}canActivate(){return this.helpService.getUserType()==r.F.user||(this.router.navigate(["/dashboard/superadmin"]),!1)}}return h.\u0275fac=function(f){return new(f||h)(M.LFG(H.F0),M.LFG(W.s))},h.\u0275prov=M.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()],loadChildren:()=>Promise.all([C.e(431),C.e(762)]).then(C.bind(C,8762)).then(h=>h.UsersModule)},{path:"settings",loadChildren:()=>C.e(77).then(C.bind(C,6077)).then(h=>h.ProfileSettingsdModule)}];let m=(()=>{class h{}return h.\u0275fac=function(f){return new(f||h)},h.\u0275mod=M.oAB({type:h}),h.\u0275inj=M.cJS({imports:[[H.Bz.forChild(_)],H.Bz]}),h})();var x=C(6895),p=C(680),b=C(6741),l=C(1208),w=C(5592);let R=(()=>{class h{}return h.\u0275fac=function(f){return new(f||h)},h.\u0275mod=M.oAB({type:h}),h.\u0275inj=M.cJS({providers:[w.r],imports:[[x.ez,m,p.w,b.Q,l.QG]]}),h})()},5592:(j,L,C)=>{C.d(L,{F:()=>M,r:()=>T});var H=C(5861),r=C(8274),M=(()=>{return(c=M||(M={}))[c.Up=1]="Up",c[c.Down=3]="Down",c[c.Right=6]="Right",c[c.Left=8]="Left",c[c.UpMirrored=2]="UpMirrored",c[c.DownMirrored=4]="DownMirrored",c[c.LeftMirrored=5]="LeftMirrored",c[c.RightMirrored=7]="RightMirrored",c[c.Default=0]="Default",c[c.NotJpeg=-1]="NotJpeg",c[c.NotDefined=-2]="NotDefined",M;var c})();class y{}y.getOrientation=c=>new Promise((_,m)=>{try{const x=new FileReader;x.onload=()=>{const p=new DataView(x.result);if(!p.byteLength||65496!==p.getUint16(0,!1))return _(M.NotDefined);const b=p.byteLength;let l=2;for(;l<b;){const w=p.getUint16(l,!1);if(l+=2,65505===w){if(1165519206!==p.getUint32(l+=2,!1))return _(M.NotJpeg);const R=18761===p.getUint16(l+=6,!1);l+=p.getUint32(l+4,R);const h=p.getUint16(l,R);l+=2;for(let d=0;d<h;d++)if(274===p.getUint16(l+12*d,R))return _(p.getUint16(l+12*d+8,R))}else{if(65280!=(65280&w))break;l+=p.getUint16(l,!1)}}return _(M.NotJpeg)},x.readAsArrayBuffer(c)}catch{return m(M.Default)}}),y.uploadFile=(c,_=!0,m=!1)=>new Promise(function(x,p){const b=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),l=/iPad|iPhone|iPod/i.test(navigator.userAgent);Promise.resolve(b||l).then(w=>w?y.generateUploadInputNative(window.document,_,m):y.generateUploadInputRenderer(c,_,m)).then(w=>{const R=w?Array.from(w):[],h=R.map(z=>y.getOrientation(z)),d=R.map(z=>y.fileToDataURL(z));let f=[];Promise.all(h).then(z=>(f=z,Promise.all(d))).then(z=>{const U=z.map((O,Z)=>({image:O.dataUrl,orientation:f[Z],fileName:O.fileName}));x(_?U:U[0])})}).catch(w=>p(w))}),y.fileToDataURL=c=>new Promise((_,m)=>{const x=new FileReader;x.onload=p=>{_({dataUrl:p.target.result,fileName:c.name})};try{x.readAsDataURL(c)}catch(p){m(`ngx-image-compress - probably no file have been selected: ${p}`)}}),y.generateUploadInputRenderer=(c,_=!0,m=!1)=>{let x=!1;return new Promise((p,b)=>{const l=c.createElement("input");c.setStyle(l,"display","none"),c.setProperty(l,"type","file"),c.setProperty(l,"accept","image/*"),_&&c.setProperty(l,"multiple","true"),c.listen(l,"click",w=>{w.target.value=""}),c.listen(l,"change",w=>{x=!0,p(w.target.files)}),m&&window.addEventListener("focus",()=>{setTimeout(()=>{x||b(new Error("file upload on blur - no file selected"))},300)},{once:!0}),l.click()})},y.generateUploadInputNative=(c,_=!0,m=!1)=>{let x=!1;return new Promise((p,b)=>{const l=c.createElement("input");l.id="upload-input"+new Date,l.style.display="none",l.setAttribute("type","file"),l.setAttribute("accept","image/*"),_&&l.setAttribute("multiple","true"),c.body.appendChild(l),l.addEventListener("change",()=>{x=!0,p(l.files),c.body.removeChild(c.getElementById(l.id))},{once:!0}),m&&window.addEventListener("focus",()=>{setTimeout(()=>{!x&&c.getElementById(l.id)&&(b(new Error("file upload on blur - no file selected")),c.body.removeChild(c.getElementById(l.id)))},300)},{once:!0}),l.click()})},y.compress=(c,_,m,x=50,p=50,b=0,l=0)=>new Promise(function(w,R){p/=100,x/=100;const h=new Image;h.onload=()=>{const d=m.createElement("canvas"),f=d.getContext("2d");if(!f)return R("No canvas context available");let z=h.naturalWidth,U=h.naturalHeight;if(!CSS.supports("image-orientation","from-image")&&(_===M.Right||_===M.Left)){const N=z;z=U,U=N}x=Math.min(x,b?b/z:1,l?l/U:1),d.width=z*x,d.height=U*x;const P=Math.PI/180;CSS.supports("image-orientation","from-image")||_===M.Up?f.drawImage(h,0,0,d.width,d.height):_===M.Right?(f.save(),f.rotate(90*P),f.translate(0,-d.width),f.drawImage(h,0,0,d.height,d.width),f.restore()):_===M.Left?(f.save(),f.rotate(-90*P),f.translate(-d.width,0),f.drawImage(h,0,0,d.height,d.width),f.restore()):_===M.Down?(f.save(),f.rotate(180*P),f.translate(-d.width,-d.height),f.drawImage(h,0,0,d.width,d.height),f.restore()):f.drawImage(h,0,0,d.width,d.height);const K=c.substr(5,c.split(";")[0].length-5),$=d.toDataURL(K,p);w($)},h.onerror=d=>R(d),h.src=c}),y.byteCount=c=>encodeURI(c).split(/%..|./).length-1,y.getImageMaxSize=function(){var c=(0,H.Z)(function*(_,m,x,p=!1){const l=h=>(h/1024/1024).toFixed(2);m&&console.debug("NgxImageCompress - Opening upload window");const w=yield y.uploadFile(x,!1,p);let R;for(let h=0;h<10;h++){const d=y.byteCount(w.image);R=yield y.compress(w.image,w.orientation,x,50,100);const f=y.byteCount(R);if(console.debug("NgxImageCompress -","Compression from",l(d),"MB to",l(f),"MB"),f>=d)throw 0===h?(m&&console.debug("NgxImageCompress -","File can't be reduced at all - returning the original",l(d),"MB large"),{...w,image:R}):(m&&console.debug("NgxImageCompress -","File can't be reduced more - returning the best we can, which is ",l(d),"MB large"),{...w,image:R});if(f<1024*_*1024)return m&&console.debug("NgxImageCompress -","Here your file",l(f),"MB large"),{...w,image:R};if(9===h)throw m&&console.debug("NgxImageCompress -","File can't reach the desired size after",10,"tries. Returning file ",l(d),"MB large"),{...w,image:R};m&&console.debug("NgxImageCompress -","Reached",l(f),"MB large. Trying another time after",h+1,"times"),w.image=R}throw m&&console.debug("NgxImageCompress - Unexpected error"),{}});return function(_,m,x){return c.apply(this,arguments)}}();let T=(()=>{class c{constructor(m){this.DOC_ORIENTATION=M,this.render=m.createRenderer(null,null)}byteCount(m){return y.byteCount(m)}getOrientation(m){return y.getOrientation(m)}uploadFile(){return y.uploadFile(this.render,!1)}uploadMultipleFiles(){return y.uploadFile(this.render,!0)}uploadFileOrReject(){return y.uploadFile(this.render,!1,!0)}uploadMultipleFilesOrReject(){return y.uploadFile(this.render,!0,!0)}compressFile(m,x,p=50,b=50,l=0,w=0){return y.compress(m,x,this.render,p,b,l,w)}uploadAndGetImageWithMaxSize(m=1,x=!1,p=!1){return y.getImageMaxSize(m,x,this.render,p).then(b=>b.image).catch(b=>{throw b.image})}uploadAndGetImageWithMaxSizeAndMetas(m=1,x=!1,p=!1){return y.getImageMaxSize(m,x,this.render,p)}}return c.\u0275fac=function(m){return new(m||c)(r.LFG(r.FYo))},c.\u0275prov=r.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},1208:(j,L,C)=>{C.d(L,{QG:()=>N,ap:()=>$});var H=C(5861),r=C(8274),M=C(1481),W=C(6895);const y=["wrapper"],T=["sourceImage"];function c(s,g){if(1&s){const e=r.EpF();r.TgZ(0,"img",4,5),r.NdJ("load",function(){return r.CHM(e),r.oxw().imageLoadedInView()})("mousedown",function(i){r.CHM(e);const a=r.oxw();return a.startMove(i,a.moveTypes.Drag)})("touchstart",function(i){r.CHM(e);const a=r.oxw();return a.startMove(i,a.moveTypes.Drag)})("error",function(i){return r.CHM(e),r.oxw().loadImageError(i)}),r.qZA()}if(2&s){const e=r.oxw();r.Udp("visibility",e.imageVisible?"visible":"hidden")("transform",e.safeTransformStyle),r.ekj("ngx-ic-draggable",!e.disabled&&e.allowMoveImage),r.Q6J("src",e.safeImgDataUrl,r.LSH),r.uIk("alt",e.imageAltText)}}function _(s,g){if(1&s){const e=r.EpF();r.ynx(0),r.TgZ(1,"span",9),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"topleft")})("touchstart",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"topleft")}),r._UZ(2,"span",10),r.qZA(),r.TgZ(3,"span",11),r._UZ(4,"span",10),r.qZA(),r.TgZ(5,"span",12),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"topright")})("touchstart",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"topright")}),r._UZ(6,"span",10),r.qZA(),r.TgZ(7,"span",13),r._UZ(8,"span",10),r.qZA(),r.TgZ(9,"span",14),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"bottomright")})("touchstart",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"bottomright")}),r._UZ(10,"span",10),r.qZA(),r.TgZ(11,"span",15),r._UZ(12,"span",10),r.qZA(),r.TgZ(13,"span",16),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"bottomleft")})("touchstart",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"bottomleft")}),r._UZ(14,"span",10),r.qZA(),r.TgZ(15,"span",17),r._UZ(16,"span",10),r.qZA(),r.TgZ(17,"span",18),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"top")})("touchstart",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"top")}),r.qZA(),r.TgZ(18,"span",19),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"right")})("touchstart",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"right")}),r.qZA(),r.TgZ(19,"span",20),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"bottom")})("touchstart",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"bottom")}),r.qZA(),r.TgZ(20,"span",21),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"left")})("touchstart",function(i){r.CHM(e);const a=r.oxw(2);return a.startMove(i,a.moveTypes.Resize,"left")}),r.qZA(),r.BQk()}}function m(s,g){if(1&s){const e=r.EpF();r.TgZ(0,"div",6),r.NdJ("keydown",function(i){return r.CHM(e),r.oxw().keyboardAccess(i)}),r.TgZ(1,"div",7),r.NdJ("mousedown",function(i){r.CHM(e);const a=r.oxw();return a.startMove(i,a.moveTypes.Move)})("touchstart",function(i){r.CHM(e);const a=r.oxw();return a.startMove(i,a.moveTypes.Move)}),r.qZA(),r.YNc(2,_,21,0,"ng-container",8),r.qZA()}if(2&s){const e=r.oxw();r.Udp("top",e.cropper.y1,"px")("left",e.cropper.x1,"px")("width",e.cropper.x2-e.cropper.x1,"px")("height",e.cropper.y2-e.cropper.y1,"px")("margin-left","center"===e.alignImage?e.marginLeft:null)("visibility",e.imageVisible?"visible":"hidden"),r.ekj("ngx-ic-round",e.roundCropper),r.xp6(2),r.Q6J("ngIf",!e.hideResizeSquares)}}class x{constructor(){this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resetCropOnAspectRatioChange=!0,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperMaxHeight=0,this.cropperMaxWidth=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.backgroundColor=null,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.alignImage="center",this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=this.initialStepSize}setOptions(g){Object.keys(g).filter(e=>e in this).forEach(e=>this[e]=g[e]),this.validateOptions()}setOptionsFromChanges(g){Object.keys(g).filter(e=>e in this).forEach(e=>this[e]=g[e].currentValue),this.validateOptions()}validateOptions(){if(this.maintainAspectRatio&&!this.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}}var p=(()=>{return(s=p||(p={})).Drag="drag",s.Move="move",s.Resize="resize",s.Pinch="pinch",p;var s})();function h(s,g){return s/100*g}let d=(()=>{class s{crop(e,t,i,a){const n=this.getImagePosition(e,t,i,a),o=n.x2-n.x1,u=n.y2-n.y1,A=document.createElement("canvas");A.width=o,A.height=u;const S=A.getContext("2d");if(!S)return null;null!=a.backgroundColor&&(S.fillStyle=a.backgroundColor,S.fillRect(0,0,o,u));const v=(a.transform.scale||1)*(a.transform.flipH?-1:1),B=(a.transform.scale||1)*(a.transform.flipV?-1:1),{translateH:Q,translateV:D}=this.getCanvasTranslate(e,t,a),E=t.transformed;S.setTransform(v,0,0,B,E.size.width/2+Q,E.size.height/2+D),S.translate(-n.x1/v,-n.y1/B),S.rotate((a.transform.rotate||0)*Math.PI/180),S.drawImage(E.image,-E.size.width/2,-E.size.height/2);const I={width:o,height:u,imagePosition:n,cropperPosition:{...i}};a.containWithinAspectRatio&&(I.offsetImagePosition=this.getOffsetImagePosition(e,t,i,a));const X=this.getResizeRatio(o,u,a);return 1!==X&&(I.width=Math.round(o*X),I.height=a.maintainAspectRatio?Math.round(I.width/a.aspectRatio):Math.round(u*X),function R(s,g,e){const t=s.width,i=s.height,a=t/(g=Math.round(g)),n=i/(e=Math.round(e)),o=Math.ceil(a/2),u=Math.ceil(n/2),A=s.getContext("2d");if(A){const S=A.getImageData(0,0,t,i),v=A.createImageData(g,e),B=S.data,Q=v.data;for(let D=0;D<e;D++)for(let E=0;E<g;E++){const I=4*(E+D*g),X=D*n;let F=0,V=0,te=0,ie=0,ae=0,re=0,ne=0;const ce=Math.floor(E*a),he=Math.floor(D*n);let q=Math.ceil((E+1)*a),ee=Math.ceil((D+1)*n);q=Math.min(q,t),ee=Math.min(ee,i);for(let G=he;G<ee;G++){const oe=Math.abs(X-G)/u,ge=E*a,pe=oe*oe;for(let J=ce;J<q;J++){const se=Math.abs(ge-J)/o,k=Math.sqrt(pe+se*se);if(k>=1)continue;F=2*k*k*k-3*k*k+1;const Y=4*(J+G*t);ne+=F*B[Y+3],te+=F,B[Y+3]<255&&(F=F*B[Y+3]/250),ie+=F*B[Y],ae+=F*B[Y+1],re+=F*B[Y+2],V+=F}}Q[I]=ie/V,Q[I+1]=ae/V,Q[I+2]=re/V,Q[I+3]=ne/te}s.width=g,s.height=e,A.putImageData(v,0,0)}}(A,I.width,I.height)),I.base64=A.toDataURL("image/"+a.format,this.getQuality(a)),I}getCanvasTranslate(e,t,i){if("px"===i.transform.translateUnit){const a=this.getRatio(e,t);return{translateH:(i.transform.translateH||0)*a,translateV:(i.transform.translateV||0)*a}}return{translateH:i.transform.translateH?h(i.transform.translateH,t.transformed.size.width):0,translateV:i.transform.translateV?h(i.transform.translateV,t.transformed.size.height):0}}getRatio(e,t){return t.transformed.size.width/e.nativeElement.offsetWidth}getImagePosition(e,t,i,a){const n=this.getRatio(e,t),o={x1:Math.round(i.x1*n),y1:Math.round(i.y1*n),x2:Math.round(i.x2*n),y2:Math.round(i.y2*n)};return a.containWithinAspectRatio||(o.x1=Math.max(o.x1,0),o.y1=Math.max(o.y1,0),o.x2=Math.min(o.x2,t.transformed.size.width),o.y2=Math.min(o.y2,t.transformed.size.height)),o}getOffsetImagePosition(e,t,i,a){const u=t.transformed.size.width/e.nativeElement.offsetWidth;let A,S;(a.canvasRotation+t.exifTransform.rotate)%2?(A=(t.transformed.size.width-t.original.size.height)/2,S=(t.transformed.size.height-t.original.size.width)/2):(A=(t.transformed.size.width-t.original.size.width)/2,S=(t.transformed.size.height-t.original.size.height)/2);const v={x1:Math.round(i.x1*u)-A,y1:Math.round(i.y1*u)-S,x2:Math.round(i.x2*u)-A,y2:Math.round(i.y2*u)-S};return a.containWithinAspectRatio||(v.x1=Math.max(v.x1,0),v.y1=Math.max(v.y1,0),v.x2=Math.min(v.x2,t.transformed.size.width),v.y2=Math.min(v.y2,t.transformed.size.height)),v}getResizeRatio(e,t,i){const a=i.resizeToWidth/e,n=i.resizeToHeight/t,o=new Array;i.resizeToWidth>0&&o.push(a),i.resizeToHeight>0&&o.push(n);const u=0===o.length?1:Math.min(...o);return u>1&&!i.onlyScaleDown?u:Math.min(u,1)}getQuality(e){return Math.min(1,Math.max(0,e.imageQuality/100))}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=r.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),f=(()=>{class s{resetCropperPosition(e,t,i){if(!e?.nativeElement)return;const a=e.nativeElement;if(i.cropperStaticHeight&&i.cropperStaticWidth)t.x1=0,t.x2=a.offsetWidth>i.cropperStaticWidth?i.cropperStaticWidth:a.offsetWidth,t.y1=0,t.y2=a.offsetHeight>i.cropperStaticHeight?i.cropperStaticHeight:a.offsetHeight;else{const n=Math.min(i.cropperScaledMaxWidth,a.offsetWidth),o=Math.min(i.cropperScaledMaxHeight,a.offsetHeight);if(i.maintainAspectRatio)if(a.offsetWidth/i.aspectRatio<a.offsetHeight){t.x1=0,t.x2=n;const u=n/i.aspectRatio;t.y1=(a.offsetHeight-u)/2,t.y2=t.y1+u}else{t.y1=0,t.y2=o;const u=o*i.aspectRatio;t.x1=(a.offsetWidth-u)/2,t.x2=t.x1+u}else t.x1=0,t.x2=n,t.y1=0,t.y2=o}}move(e,t,i){const a=this.getClientX(e)-t.clientX,n=this.getClientY(e)-t.clientY;i.x1=t.x1+a,i.y1=t.y1+n,i.x2=t.x2+a,i.y2=t.y2+n}resize(e,t,i,a,n){const o=this.getClientX(e)-t.clientX,u=this.getClientY(e)-t.clientY;switch(t.position){case"left":i.x1=Math.min(Math.max(t.x1+o,i.x2-n.cropperScaledMaxWidth),i.x2-n.cropperScaledMinWidth);break;case"topleft":i.x1=Math.min(Math.max(t.x1+o,i.x2-n.cropperScaledMaxWidth),i.x2-n.cropperScaledMinWidth),i.y1=Math.min(Math.max(t.y1+u,i.y2-n.cropperScaledMaxHeight),i.y2-n.cropperScaledMinHeight);break;case"top":i.y1=Math.min(Math.max(t.y1+u,i.y2-n.cropperScaledMaxHeight),i.y2-n.cropperScaledMinHeight);break;case"topright":i.x2=Math.max(Math.min(t.x2+o,i.x1+n.cropperScaledMaxWidth),i.x1+n.cropperScaledMinWidth),i.y1=Math.min(Math.max(t.y1+u,i.y2-n.cropperScaledMaxHeight),i.y2-n.cropperScaledMinHeight);break;case"right":i.x2=Math.max(Math.min(t.x2+o,i.x1+n.cropperScaledMaxWidth),i.x1+n.cropperScaledMinWidth);break;case"bottomright":i.x2=Math.max(Math.min(t.x2+o,i.x1+n.cropperScaledMaxWidth),i.x1+n.cropperScaledMinWidth),i.y2=Math.max(Math.min(t.y2+u,i.y1+n.cropperScaledMaxHeight),i.y1+n.cropperScaledMinHeight);break;case"bottom":i.y2=Math.max(Math.min(t.y2+u,i.y1+n.cropperScaledMaxHeight),i.y1+n.cropperScaledMinHeight);break;case"bottomleft":i.x1=Math.min(Math.max(t.x1+o,i.x2-n.cropperScaledMaxWidth),i.x2-n.cropperScaledMinWidth),i.y2=Math.max(Math.min(t.y2+u,i.y1+n.cropperScaledMaxHeight),i.y1+n.cropperScaledMinHeight);break;case"center":const A=e.scale,S=Math.min(Math.max(n.cropperScaledMinWidth,Math.abs(t.x2-t.x1)*A),n.cropperScaledMaxWidth),v=Math.min(Math.max(n.cropperScaledMinHeight,Math.abs(t.y2-t.y1)*A),n.cropperScaledMaxHeight);i.x1=t.clientX-S/2,i.x2=t.clientX+S/2,i.y1=t.clientY-v/2,i.y2=t.clientY+v/2,i.x1<0?(i.x2-=i.x1,i.x1=0):i.x2>a.width&&(i.x1-=i.x2-a.width,i.x2=a.width),i.y1<0?(i.y2-=i.y1,i.y1=0):i.y2>a.height&&(i.y1-=i.y2-a.height,i.y2=a.height)}n.maintainAspectRatio&&this.checkAspectRatio(t.position,i,a,n)}checkAspectRatio(e,t,i,a){let n=0,o=0;switch(e){case"top":t.x2=t.x1+(t.y2-t.y1)*a.aspectRatio,n=Math.max(t.x2-i.width,0),o=Math.max(0-t.y1,0),(n>0||o>0)&&(t.x2-=o*a.aspectRatio>n?o*a.aspectRatio:n,t.y1+=o*a.aspectRatio>n?o:n/a.aspectRatio);break;case"bottom":t.x2=t.x1+(t.y2-t.y1)*a.aspectRatio,n=Math.max(t.x2-i.width,0),o=Math.max(t.y2-i.height,0),(n>0||o>0)&&(t.x2-=o*a.aspectRatio>n?o*a.aspectRatio:n,t.y2-=o*a.aspectRatio>n?o:n/a.aspectRatio);break;case"topleft":t.y1=t.y2-(t.x2-t.x1)/a.aspectRatio,n=Math.max(0-t.x1,0),o=Math.max(0-t.y1,0),(n>0||o>0)&&(t.x1+=o*a.aspectRatio>n?o*a.aspectRatio:n,t.y1+=o*a.aspectRatio>n?o:n/a.aspectRatio);break;case"topright":t.y1=t.y2-(t.x2-t.x1)/a.aspectRatio,n=Math.max(t.x2-i.width,0),o=Math.max(0-t.y1,0),(n>0||o>0)&&(t.x2-=o*a.aspectRatio>n?o*a.aspectRatio:n,t.y1+=o*a.aspectRatio>n?o:n/a.aspectRatio);break;case"right":case"bottomright":t.y2=t.y1+(t.x2-t.x1)/a.aspectRatio,n=Math.max(t.x2-i.width,0),o=Math.max(t.y2-i.height,0),(n>0||o>0)&&(t.x2-=o*a.aspectRatio>n?o*a.aspectRatio:n,t.y2-=o*a.aspectRatio>n?o:n/a.aspectRatio);break;case"left":case"bottomleft":t.y2=t.y1+(t.x2-t.x1)/a.aspectRatio,n=Math.max(0-t.x1,0),o=Math.max(t.y2-i.height,0),(n>0||o>0)&&(t.x1+=o*a.aspectRatio>n?o*a.aspectRatio:n,t.y2-=o*a.aspectRatio>n?o:n/a.aspectRatio);break;case"center":t.x2=t.x1+(t.y2-t.y1)*a.aspectRatio,t.y2=t.y1+(t.x2-t.x1)/a.aspectRatio;const u=Math.max(0-t.x1,0),A=Math.max(t.x2-i.width,0),S=Math.max(t.y2-i.height,0),v=Math.max(0-t.y1,0);(u>0||A>0||S>0||v>0)&&(t.x1+=S*a.aspectRatio>u?S*a.aspectRatio:u,t.x2-=v*a.aspectRatio>A?v*a.aspectRatio:A,t.y1+=v*a.aspectRatio>A?v:A/a.aspectRatio,t.y2-=S*a.aspectRatio>u?S:u/a.aspectRatio)}}getClientX(e){return e.touches?.[0].clientX||e.clientX||0}getClientY(e){return e.touches?.[0].clientY||e.clientY||0}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=r.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();let K=(()=>{class s{constructor(){this.autoRotateSupported=function U(){return new Promise(s=>{const g=new Image;g.onload=()=>{s(1===g.width&&2===g.height)},g.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="})}()}loadImageFile(e,t){return new Promise((i,a)=>{const n=new FileReader;n.onload=o=>{this.loadImage(o.target.result,e.type,t).then(i).catch(a)},n.readAsDataURL(e)})}loadImage(e,t,i){return this.isValidImageType(t)?this.loadBase64Image(e,i):Promise.reject(new Error("Invalid image type"))}isValidImageType(e){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp|x-icon|vnd.microsoft.icon)/.test(e)}loadImageFromURL(e,t){return new Promise((i,a)=>{const n=new Image;n.onerror=()=>a,n.onload=()=>{const o=document.createElement("canvas"),u=o.getContext("2d");o.width=n.width,o.height=n.height,u?.drawImage(n,0,0),this.loadBase64Image(o.toDataURL(),t).then(i)},n.crossOrigin="anonymous",n.src=e})}loadBase64Image(e,t){return new Promise((i,a)=>{const n=new Image;n.onload=()=>i({originalImage:n,originalBase64:e}),n.onerror=a,n.src=e}).then(i=>this.transformImageBase64(i,t))}transformImageBase64(e,t){var i=this;return(0,H.Z)(function*(){const a=yield i.autoRotateSupported,n=yield function O(s){switch("string"==typeof s&&(s=function Z(s){const g=new DataView(function P(s){s=s.replace(/^data\:([^\;]+)\;base64,/gim,"");const g=atob(s),e=g.length,t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=g.charCodeAt(i);return t.buffer}(s));if(65496!==g.getUint16(0,!1))return-2;const e=g.byteLength;let t=2;for(;t<e;){if(g.getUint16(t+2,!1)<=8)return-1;const i=g.getUint16(t,!1);if(t+=2,65505==i){if(1165519206!==g.getUint32(t+=2,!1))return-1;const a=18761==g.getUint16(t+=6,!1);t+=g.getUint32(t+4,a);const n=g.getUint16(t,a);t+=2;for(let o=0;o<n;o++)if(274==g.getUint16(t+12*o,a))return g.getUint16(t+12*o+8,a)}else{if(65280!=(65280&i))break;t+=g.getUint16(t,!1)}}return-1}(s)),s){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(a?-1:e.originalBase64);return e.originalImage&&e.originalImage.complete?i.transformLoadedImage({original:{base64:e.originalBase64,image:e.originalImage,size:{width:e.originalImage.naturalWidth,height:e.originalImage.naturalHeight}},exifTransform:n},t):Promise.reject(new Error("No image loaded"))})()}transformLoadedImage(e,t){var i=this;return(0,H.Z)(function*(){const a=t.canvasRotation+e.exifTransform.rotate,n={width:e.original.image.naturalWidth,height:e.original.image.naturalHeight};if(0===a&&!e.exifTransform.flip&&!t.containWithinAspectRatio)return{original:{base64:e.original.base64,image:e.original.image,size:{...n}},transformed:{base64:e.original.base64,image:e.original.image,size:{...n}},exifTransform:e.exifTransform};const o=i.getTransformedSize(n,e.exifTransform,t),u=document.createElement("canvas");u.width=o.width,u.height=o.height;const A=u.getContext("2d");A?.setTransform(e.exifTransform.flip?-1:1,0,0,1,u.width/2,u.height/2),A?.rotate(Math.PI*(a/2)),A?.drawImage(e.original.image,-n.width/2,-n.height/2);const S=u.toDataURL(),v=yield i.loadImageFromBase64(S);return{original:{base64:e.original.base64,image:e.original.image,size:{...n}},transformed:{base64:S,image:v,size:{width:v.width,height:v.height}},exifTransform:e.exifTransform}})()}loadImageFromBase64(e){return new Promise((t,i)=>{const a=new Image;a.onload=()=>t(a),a.onerror=i,a.src=e})}getTransformedSize(e,t,i){const a=i.canvasRotation+t.rotate;if(i.containWithinAspectRatio){if(a%2){const o=e.height/i.aspectRatio;return{width:Math.max(e.height,e.width*i.aspectRatio),height:Math.max(e.width,o)}}{const o=e.width/i.aspectRatio;return{width:Math.max(e.width,e.height*i.aspectRatio),height:Math.max(e.height,o)}}}return a%2?{height:e.width,width:e.height}:{width:e.width,height:e.height}}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=r.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),$=(()=>{class s{constructor(e,t,i,a,n){this.cropService=e,this.cropperPositionService=t,this.loadImageService=i,this.sanitizer=a,this.cd=n,this.Hammer=window?.Hammer||null,this.settings=new x,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.marginLeft="0px",this.maxSize={width:0,height:0},this.moveTypes=p,this.imageVisible=!1,this.format=this.settings.format,this.transform={},this.maintainAspectRatio=this.settings.maintainAspectRatio,this.aspectRatio=this.settings.aspectRatio,this.resetCropOnAspectRatioChange=this.settings.resetCropOnAspectRatioChange,this.resizeToWidth=this.settings.resizeToWidth,this.resizeToHeight=this.settings.resizeToHeight,this.cropperMinWidth=this.settings.cropperMinWidth,this.cropperMinHeight=this.settings.cropperMinHeight,this.cropperMaxHeight=this.settings.cropperMaxHeight,this.cropperMaxWidth=this.settings.cropperMaxWidth,this.cropperStaticWidth=this.settings.cropperStaticWidth,this.cropperStaticHeight=this.settings.cropperStaticHeight,this.canvasRotation=this.settings.canvasRotation,this.initialStepSize=this.settings.initialStepSize,this.roundCropper=this.settings.roundCropper,this.onlyScaleDown=this.settings.onlyScaleDown,this.imageQuality=this.settings.imageQuality,this.autoCrop=this.settings.autoCrop,this.backgroundColor=this.settings.backgroundColor,this.containWithinAspectRatio=this.settings.containWithinAspectRatio,this.hideResizeSquares=this.settings.hideResizeSquares,this.allowMoveImage=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage=this.settings.alignImage,this.disabled=!1,this.hidden=!1,this.imageCropped=new r.vpe,this.startCropImage=new r.vpe,this.imageLoaded=new r.vpe,this.cropperReady=new r.vpe,this.loadImageFailed=new r.vpe,this.transformChange=new r.vpe,this.reset()}ngOnChanges(e){this.onChangesUpdateSettings(e),this.onChangesInputImage(e),this.loadedImage?.original.image.complete&&(e.containWithinAspectRatio||e.canvasRotation)&&this.loadImageService.transformLoadedImage(this.loadedImage,this.settings).then(t=>this.setLoadedImage(t)).catch(t=>this.loadImageError(t)),(e.cropper||e.maintainAspectRatio||e.aspectRatio)&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),!this.maintainAspectRatio||!this.resetCropOnAspectRatioChange&&this.aspectRatioIsCorrect()||!e.maintainAspectRatio&&!e.aspectRatio?e.cropper&&(this.checkCropperPosition(!1),this.doAutoCrop()):this.resetCropperPosition(),this.cd.markForCheck()),e.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop(),this.cd.markForCheck()),e.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesUpdateSettings(e){this.settings.setOptionsFromChanges(e),this.settings.cropperStaticHeight&&this.settings.cropperStaticWidth&&this.settings.setOptions({hideResizeSquares:!0,cropperMinWidth:this.settings.cropperStaticWidth,cropperMinHeight:this.settings.cropperStaticHeight,cropperMaxHeight:this.settings.cropperStaticHeight,cropperMaxWidth:this.settings.cropperStaticWidth,maintainAspectRatio:!1})}onChangesInputImage(e){(e.imageChangedEvent||e.imageURL||e.imageBase64||e.imageFile)&&this.reset(),e.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),e.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),e.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),e.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){return this.imageChangedEvent?.target?.files?.length>0}setCssTransform(){const e=this.transform?.translateUnit||"%";this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle(`translate(${this.transform.translateH||0}${e}, ${this.transform.translateV||0}${e}) scaleX(`+(this.transform.scale||1)*(this.transform.flipH?-1:1)+") scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+") rotate("+(this.transform.rotate||0)+"deg)")}ngOnInit(){this.settings.stepSize=this.initialStepSize,this.activatePinchGesture()}reset(){this.imageVisible=!1,this.loadedImage=void 0,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}loadImageFile(e){this.loadImageService.loadImageFile(e,this.settings).then(t=>this.setLoadedImage(t)).catch(t=>this.loadImageError(t))}loadBase64Image(e){this.loadImageService.loadBase64Image(e,this.settings).then(t=>this.setLoadedImage(t)).catch(t=>this.loadImageError(t))}loadImageFromURL(e){this.loadImageService.loadImageFromURL(e,this.settings).then(t=>this.setLoadedImage(t)).catch(t=>this.loadImageError(t))}setLoadedImage(e){this.loadedImage=e,this.safeImgDataUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e.transformed.base64),this.cd.markForCheck()}loadImageError(e){console.error(e),this.loadImageFailed.emit()}imageLoadedInView(){null!=this.loadedImage&&(this.imageLoaded.emit(this.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.resetCropperPosition(),this.cropperReady.emit({...this.maxSize}),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>0}onResize(){!this.loadedImage||(this.hidden?this.resizedWhileHidden=!0:(this.resizeCropperPosition(),this.setMaxSize(),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()))}activatePinchGesture(){if(this.Hammer){const e=new this.Hammer(this.wrapper.nativeElement);e.get("pinch").set({enable:!0}),e.on("pinchmove",this.onPinch.bind(this)),e.on("pinchend",this.pinchStop.bind(this)),e.on("pinchstart",this.startPinch.bind(this))}else(0,r.X6Q)()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")}resizeCropperPosition(){const e=this.sourceImage.nativeElement;(this.maxSize.width!==e.offsetWidth||this.maxSize.height!==e.offsetHeight)&&(this.cropper.x1=this.cropper.x1*e.offsetWidth/this.maxSize.width,this.cropper.x2=this.cropper.x2*e.offsetWidth/this.maxSize.width,this.cropper.y1=this.cropper.y1*e.offsetHeight/this.maxSize.height,this.cropper.y2=this.cropper.y2*e.offsetHeight/this.maxSize.height)}resetCropperPosition(){this.cropperPositionService.resetCropperPosition(this.sourceImage,this.cropper,this.settings),this.doAutoCrop(),this.imageVisible=!0}keyboardAccess(e){this.changeKeyboardStepSize(e),this.keyboardMoveCropper(e)}changeKeyboardStepSize(e){const t=+e.key;t>=1&&t<=9&&(this.settings.stepSize=t)}keyboardMoveCropper(e){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(e.key))return;const i=e.shiftKey?p.Resize:p.Move,a=e.altKey?function l(s){switch(s){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";default:return"right"}}(e.key):function b(s){switch(s){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";default:return"left"}}(e.key),n=function w(s,g){switch(s){case"ArrowUp":return{clientX:0,clientY:-1*g};case"ArrowRight":return{clientX:g,clientY:0};case"ArrowDown":return{clientX:0,clientY:g};default:return{clientX:-1*g,clientY:0}}}(e.key,this.settings.stepSize);e.preventDefault(),e.stopPropagation(),this.startMove({clientX:0,clientY:0},i,a),this.moveImg(n),this.moveStop()}startMove(e,t,i=null){this.disabled||this.moveStart?.active&&this.moveStart?.type===p.Pinch||t===p.Drag&&!this.allowMoveImage||(e.preventDefault&&e.preventDefault(),this.moveStart={active:!0,type:t,position:i,transform:{...this.transform},clientX:this.cropperPositionService.getClientX(e),clientY:this.cropperPositionService.getClientY(e),...this.cropper})}startPinch(e){!this.safeImgDataUrl||(e.preventDefault&&e.preventDefault(),this.moveStart={active:!0,type:p.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2,...this.cropper})}moveImg(e){if(this.moveStart.active){if(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.moveStart.type===p.Move)this.cropperPositionService.move(e,this.moveStart,this.cropper),this.checkCropperPosition(!0);else if(this.moveStart.type===p.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.cropperPositionService.resize(e,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1);else if(this.moveStart.type===p.Drag){const t=this.cropperPositionService.getClientX(e)-this.moveStart.clientX,i=this.cropperPositionService.getClientY(e)-this.moveStart.clientY;this.transform={...this.transform,translateH:(this.moveStart.transform?.translateH||0)+t,translateV:(this.moveStart.transform?.translateV||0)+i},this.setCssTransform()}this.cd.detectChanges()}}onPinch(e){this.moveStart.active&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.moveStart.type===p.Pinch&&(this.cropperPositionService.resize(e,this.moveStart,this.cropper,this.maxSize,this.settings),this.checkCropperPosition(!1)),this.cd.detectChanges())}setMaxSize(){if(this.sourceImage){const e=this.sourceImage.nativeElement;this.maxSize.width=e.offsetWidth,this.maxSize.height=e.offsetHeight,this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}setCropperScaledMinSize(){this.loadedImage?.transformed?.image?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.settings.cropperScaledMinWidth=20,this.settings.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.settings.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.loadedImage.transformed.image.width*this.maxSize.width):20}setCropperScaledMinHeight(){this.settings.cropperScaledMinHeight=this.maintainAspectRatio?Math.max(20,this.settings.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?Math.max(20,this.cropperMinHeight/this.loadedImage.transformed.image.height*this.maxSize.height):20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed?.image){const e=this.loadedImage.transformed.size.width/this.maxSize.width;this.settings.cropperScaledMaxWidth=this.cropperMaxWidth>20?this.cropperMaxWidth/e:this.maxSize.width,this.settings.cropperScaledMaxHeight=this.cropperMaxHeight>20?this.cropperMaxHeight/e:this.maxSize.height,this.maintainAspectRatio&&(this.settings.cropperScaledMaxWidth>this.settings.cropperScaledMaxHeight*this.aspectRatio?this.settings.cropperScaledMaxWidth=this.settings.cropperScaledMaxHeight*this.aspectRatio:this.settings.cropperScaledMaxWidth<this.settings.cropperScaledMaxHeight*this.aspectRatio&&(this.settings.cropperScaledMaxHeight=this.settings.cropperScaledMaxWidth/this.aspectRatio))}else this.settings.cropperScaledMaxWidth=this.maxSize.width,this.settings.cropperScaledMaxHeight=this.maxSize.height}checkCropperPosition(e=!1){this.cropper.x1<0&&(this.cropper.x2-=e?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=e?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=e?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=e?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}moveStop(){this.moveStart.active&&(this.moveStart.active=!1,this.moveStart?.type===p.Drag?this.transformChange.emit(this.transform):this.doAutoCrop())}pinchStop(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}doAutoCrop(){this.autoCrop&&this.crop()}crop(){if(null!=this.loadedImage?.transformed?.image){this.startCropImage.emit();const e=this.cropService.crop(this.sourceImage,this.loadedImage,this.cropper,this.settings);return null!=e&&this.imageCropped.emit(e),e}return null}aspectRatioIsCorrect(){return(this.cropper.x2-this.cropper.x1)/(this.cropper.y2-this.cropper.y1)===this.aspectRatio}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(d),r.Y36(f),r.Y36(K),r.Y36(M.H7),r.Y36(r.sBO))},s.\u0275cmp=r.Xpm({type:s,selectors:[["image-cropper"]],viewQuery:function(e,t){if(1&e&&(r.Gf(y,7),r.Gf(T,5)),2&e){let i;r.iGM(i=r.CRH())&&(t.wrapper=i.first),r.iGM(i=r.CRH())&&(t.sourceImage=i.first)}},hostVars:6,hostBindings:function(e,t){1&e&&r.NdJ("resize",function(){return t.onResize()},!1,r.Jf7)("mousemove",function(a){return t.moveImg(a)},!1,r.evT)("touchmove",function(a){return t.moveImg(a)},!1,r.evT)("mouseup",function(){return t.moveStop()},!1,r.evT)("touchend",function(){return t.moveStop()},!1,r.evT),2&e&&(r.Udp("text-align",t.alignImage),r.ekj("disabled",t.disabled)("ngx-ix-hidden",t.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",format:"format",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange"},features:[r.TTD],decls:5,vars:10,consts:[["wrapper",""],["class","ngx-ic-source-image",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],[1,"ngx-ic-source-image",3,"src","load","mousedown","touchstart","error"],["sourceImage",""],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],[1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],[1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],[1,"ngx-ic-resize","ngx-ic-top"],[1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right"],[1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom"],[1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left"],[1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"]],template:function(e,t){1&e&&(r.TgZ(0,"div",null,0),r.YNc(2,c,2,8,"img",1),r._UZ(3,"div",2),r.YNc(4,m,3,15,"div",3),r.qZA()),2&e&&(r.Udp("background",t.imageVisible&&t.backgroundColor),r.xp6(2),r.Q6J("ngIf",t.safeImgDataUrl),r.xp6(1),r.Udp("width",t.maxSize.width,"px")("height",t.maxSize.height,"px")("margin-left","center"===t.alignImage?t.marginLeft:null),r.xp6(1),r.Q6J("ngIf",t.imageVisible))},directives:[W.O5],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:transparent;outline:rgba(255,255,255,.3) solid 100vw;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;background:#53535C;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw #ffffff4d;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh #ffffff4d;box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ix-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0}),s})(),N=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=r.oAB({type:s}),s.\u0275inj=r.cJS({imports:[[W.ez]]}),s})()},5861:(j,L,C)=>{function H(M,W,y,T,c,_,m){try{var x=M[_](m),p=x.value}catch(b){return void y(b)}x.done?W(p):Promise.resolve(p).then(T,c)}function r(M){return function(){var W=this,y=arguments;return new Promise(function(T,c){var _=M.apply(W,y);function m(p){H(_,T,c,m,x,"next",p)}function x(p){H(_,T,c,m,x,"throw",p)}m(void 0)})}}C.d(L,{Z:()=>r})}}]);