"use strict";(self.webpackChunkCityInfo=self.webpackChunkCityInfo||[]).push([[674],{674:(ti,g,s)=>{s.d(g,{d:()=>X});var f=s(7579),r=s(6637),i=s(8274),u=s(7996),h=s(5013),v=s(5453),x=s(9052),p=s(4968),T=s(818),d=s(6895),y=s(2725),l=s(8118),b=s(6256),w=s(6741),D=s(4006);const C=["grid"],E=["orderForm"],S=["editSettingsTemplate"],G=["container"];function I(e,_){1&e&&(i.TgZ(0,"div",2),i._UZ(1,"app-loader"),i.qZA())}function M(e,_){if(1&e&&(i.TgZ(0,"mat-icon",14),i._uU(1),i.qZA()),2&e){const t=i.oxw(5).$implicit;i.xp6(1),i.Oqu(t.template.classIcon)}}function O(e,_){if(1&e&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&e){const t=i.oxw(5).$implicit;i.xp6(1),i.Oqu(t.template.label)}}function P(e,_){if(1&e){const t=i.EpF();i.TgZ(0,"button",12),i.NdJ("click",function(){i.CHM(t);const o=i.oxw(2).$implicit,c=i.oxw(2).$implicit;return i.oxw(3).openPage(c.template.link,c.template.parameters,o)}),i.YNc(1,M,2,1,"mat-icon",13),i.YNc(2,O,2,1,"span",1),i.qZA()}if(2&e){const t=i.oxw(4).$implicit;i.Tol(t.template.class),i.xp6(1),i.Q6J("ngIf",t.template.classIcon),i.xp6(1),i.Q6J("ngIf",t.template.label)}}function R(e,_){if(1&e&&(i.TgZ(0,"mat-icon",14),i._uU(1),i.qZA()),2&e){const t=i.oxw(5).$implicit;i.xp6(1),i.Oqu(t.template.classIcon)}}function A(e,_){if(1&e&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&e){const t=i.oxw(5).$implicit;i.xp6(1),i.Oqu(t.template.label)}}function Z(e,_){if(1&e){const t=i.EpF();i.TgZ(0,"button",12),i.NdJ("click",function(){i.CHM(t);const o=i.oxw(2).$implicit;return i.oxw(5).previewDocument(o)}),i.YNc(1,R,2,1,"mat-icon",13),i.YNc(2,A,2,1,"span",1),i.qZA()}if(2&e){const t=i.oxw(4).$implicit;i.Tol(t.template.class),i.xp6(1),i.Q6J("ngIf",t.template.classIcon),i.xp6(1),i.Q6J("ngIf",t.template.label)}}function J(e,_){if(1&e&&(i.TgZ(0,"div"),i.YNc(1,P,3,4,"button",11),i.YNc(2,Z,3,4,"button",11),i.qZA()),2&e){const t=i.oxw().$implicit,n=i.oxw(2).$implicit;i.xp6(1),i.Q6J("ngIf","open"===n.template.action),i.xp6(1),i.Q6J("ngIf","previewDocument"===n.template.action&&"application/pdf"===t.type)}}function j(e,_){if(1&e){const t=i.EpF();i.TgZ(0,"button",16),i.NdJ("select",function(o){i.CHM(t);const c=i.oxw(2).$implicit,a=i.oxw(2).$implicit;return i.oxw(3).clickDropDownButton(o,c,a.template)}),i.qZA()}if(2&e){const t=i.oxw(4).$implicit,n=i.oxw(3);i.s9C("content",n.language[t.template.content]?n.language[t.template.content]:t.template.content),i.Q6J("items",t.template.items)}}function Q(e,_){if(1&e&&(i.TgZ(0,"div"),i.YNc(1,j,1,2,"button",15),i.qZA()),2&e){const t=i.oxw(3).$implicit;i.xp6(1),i.Q6J("ngIf",t.template.items)}}function N(e,_){if(1&e&&(i.TgZ(0,"div")(1,"mat-icon",14),i._uU(2),i.qZA()()),2&e){const t=i.oxw().$implicit,n=i.oxw(2).$implicit,o=i.oxw(3);i.xp6(2),i.Oqu(o.getFileTypeIcon(t,n.template.field))}}function Y(e,_){if(1&e&&i._UZ(0,"div",19),2&e){const t=i.oxw().$implicit;i.Q6J("innerHtml",t.html,i.oJD)}}function F(e,_){if(1&e&&i._UZ(0,"div",19),2&e){const t=i.oxw().$implicit;i.Q6J("innerHtml",t.html,i.oJD)}}function U(e,_){if(1&e&&i._UZ(0,"div",19),2&e){const t=i.oxw().$implicit;i.Q6J("innerHtml",t.html,i.oJD)}}function $(e,_){if(1&e&&i._UZ(0,"div",19),2&e){const t=i.oxw().$implicit;i.Q6J("innerHtml",t.html,i.oJD)}}function q(e,_){if(1&e&&(i.TgZ(0,"div"),i.YNc(1,Y,1,1,"div",18),i.YNc(2,F,1,1,"div",18),i.YNc(3,U,1,1,"div",18),i.YNc(4,$,1,1,"div",18),i.qZA()),2&e){const t=_.$implicit,n=i.oxw(2).$implicit;i.xp6(1),i.Q6J("ngIf","=="===t.operator&&n[t.field]===t.value),i.xp6(1),i.Q6J("ngIf","!="===t.operator&&n[t.field]!==t.value),i.xp6(1),i.Q6J("ngIf",">"===t.operator&&n[t.field]>t.value),i.xp6(1),i.Q6J("ngIf",">"===t.operator&&n[t.field]<t.value)}}function H(e,_){if(1&e&&(i.TgZ(0,"div"),i.YNc(1,q,5,4,"div",17),i.qZA()),2&e){const t=i.oxw(3).$implicit;i.xp6(1),i.Q6J("ngForOf",t.template.choices)}}function W(e,_){if(1&e&&(i.YNc(0,J,3,2,"div",1),i.YNc(1,Q,2,1,"div",1),i.YNc(2,N,3,1,"div",1),i.YNc(3,H,2,1,"div",1)),2&e){const t=i.oxw(2).$implicit;i.Q6J("ngIf","button"===t.template.type),i.xp6(1),i.Q6J("ngIf","dropdownbutton"===t.template.type),i.xp6(1),i.Q6J("ngIf","fileType"===t.template.type),i.xp6(1),i.Q6J("ngIf",t.template.choices)}}function B(e,_){1&e&&i.YNc(0,W,4,4,"ng-template",null,10,i.W1O)}function L(e,_){if(1&e&&(i.TgZ(0,"e-column",9),i.YNc(1,B,2,0,null,1),i.qZA()),2&e){const t=_.$implicit;i.Tol(t.class),i.Q6J("type",t.type)("field",t.field)("headerText",t.title)("width",t.width)("textAlign",t.position?t.position:"center")("isPrimaryKey",t.isPrimaryKey)("editType",t.editType?t.editType:null)("allowEditing",t.allowEditing)("format",t.format)("validationRules",t.validation)("allowFiltering",!1!==t.allowFiltering),i.xp6(1),i.Q6J("ngIf",t.template)}}function K(e,_){if(1&e){const t=i.EpF();i.TgZ(0,"app-dynamic-forms",23,24),i.NdJ("submit",function(o){return i.CHM(t),i.oxw(4).submitEmitter(o)}),i.qZA()}if(2&e){const t=i.oxw(4);i.Q6J("config",t.config)("partOfGrid",!0)}}function z(e,_){if(1&e&&(i.TgZ(0,"div",20)(1,"div",21),i.YNc(2,K,2,2,"app-dynamic-forms",22),i.qZA()()),2&e){const t=i.oxw(3);i.xp6(2),i.Q6J("ngIf",t.config.config&&t.config.config.length>0)}}function k(e,_){if(1&e){const t=i.EpF();i.TgZ(0,"ejs-grid",5,6),i.NdJ("actionComplete",function(o){return i.CHM(t),i.oxw(2).actionComplete(o)})("toolbarClick",function(o){return i.CHM(t),i.oxw(2).toolbarClick(o)}),i.TgZ(2,"e-columns"),i.YNc(3,L,2,14,"e-column",7),i.qZA(),i.YNc(4,z,3,1,"ng-template",null,8,i.W1O),i.qZA()}if(2&e){const t=i.oxw(2);i.Q6J("height",t.height)("dataSource",t.data)("editSettings",t.config.editSettings)("toolbar",t.config.toolbar)("allowSorting",t.config.sorting.enable)("sortSettings",t.config.sorting.initialSorting)("allowGrouping",t.config.grouping.enable)("allowResizing",t.config.allowResizing)("allowPaging",t.config.paging.enable)("allowExcelExport",!0)("allowPdfExport",!0)("pageSettings",t.config.paging.settings)("allowFiltering",t.config.filtering.enable)("filterSettings",t.config.filtering.settings)("allowExcelExport",!0)("contextMenuItems",t.config.contextMenuItems),i.xp6(3),i.Q6J("ngForOf",t.config.columns)}}function V(e,_){if(1&e&&(i.TgZ(0,"div",null,3),i.YNc(2,k,6,17,"ejs-grid",4),i.qZA()),2&e){const t=i.oxw();i.xp6(2),i.Q6J("ngIf",t.config)}}let X=(()=>{class e{constructor(t,n,o,c,a,m,ii){this.configurationService=t,this.apiService=n,this.helpService=o,this.toastr=c,this.routerNavigate=a,this.router=m,this.messageService=ii,this.typeOfModification="add",this.loader=!1,this.unsubscribe=new f.x,this.invoice={},this.generateInvoice=!1}ngOnInit(){this.loader=!0,this.initializeConfig(),this.subscribeMessageServices(),this.filterOptions={type:"Menu"}}onResize(){this.height=this.helpService.getHeightForGridWithoutPx(this.partOfTab)}initializeConfig(){this.language=this.helpService.getLanguage(),this.configurationService.getConfiguration(this.path,this.file).subscribe(t=>{this.config=t,this.height=this.helpService.getHeightForGridWithoutPx(this.partOfTab),this.loader=!1,this.enableGridSpinner(),this.apiService.callApi(this.config,this.router).subscribe(n=>{this.setResponseData(n)})})}subscribeMessageServices(){this.subscription=this.messageService.getRefreshGrid().subscribe(()=>{this.enableGridSpinner(),this.apiService.callApi(this.config,this.router).subscribe(t=>{this.setResponseData(t)}),setTimeout(()=>{this.operations.dialog.close()},50)})}actionComplete(t){("beginEdit"===t.requestType||"add"===t.requestType)&&(t.dialog.buttons=[],this.config.width&&(t.dialog.width=this.config.width),"add"===t.requestType?t.dialog.header=this.language.gridPopupAddTitle:"beginEdit"===t.requestType&&(t.dialog.header=this.language.gridPopupEditTitle),this.config.config&&setTimeout(()=>{this.setValue(this.config.config,t.rowData)},50)),"delete"===t.requestType&&(this.config.uploadConfig?this.deleteDocument(t):this.deleteData(t)),this.typeOfModification=t.requestType,this.operations=t,t.cancel=!0}submitEmitter(t){this.enableGridSpinner(),"add"===this.typeOfModification?this.callServerMethod(this.config.editSettingsRequest.add,t):"beginEdit"===this.typeOfModification&&this.callServerMethod(this.config.editSettingsRequest.edit,t),this.operations.dialog.close()}callServerMethod(t,n){this.apiService.callServerMethod(t,n,this.router).subscribe(o=>{o?(this.toastr.showSuccess(),this.apiService.callApi(this.config,this.router).subscribe(c=>{this.setResponseData(c)})):(this.toastr.showError(),this.grid.hideSpinner())})}setResponseData(t){"GET"===this.config.request.type&&(this.data=t,this.disabledGridSpinner())}enableGridSpinner(){setTimeout(()=>{this.grid.showSpinner()},50)}disabledGridSpinner(){setTimeout(()=>{this.grid.hideSpinner()},100)}deleteData(t){for(let n=0;n<t.data.length;n++)this.callServerMethod(this.config.editSettingsRequest.delete,t.data[n])}deleteDocument(t){for(let n=0;n<t.data.length;n++)this.callServerMethod(this.config.uploadConfig.delete,t.data[n])}setValue(t,n){for(let o=0;o<t.length;o++)this.form.setValue(t[o].name,n[t[o].name],t[o].type)}openPage(t,n,o){const c=this.helpService.concatenatePageLink(t,n,o);this.routerNavigate.navigate([c])}unsuscribeME(){this.unsubscribe.next(null),this.unsubscribe.complete(),this.subscription&&this.subscription.unsubscribe()}ngOnDestroy(){this.unsuscribeME()}previewDocument(t){this.apiService.getDocument(t).subscribe(n=>{let o=new Blob([n],{type:"application/pdf"});var c=URL.createObjectURL(o);window.open(c)})}getFileTypeIcon(t,n){return this.helpService.getFileTypeIcon(t[n])}clickDropDownButton(t,n,o){if(t.item.properties.id)if(o.itemsRequest&&o.itemsRequest[t.item.properties.id])this.apiService.callApi({request:o.itemsRequest[t.item.properties.id],body:n},this.router).subscribe(a=>{a?this.toastr.showSuccess():this.toastr.showError(),this.grid.hideSpinner()});else{if(o.fields&&o.fields[t.item.properties.id])for(let c=0;c<o.fields[t.item.properties.id].length;c++)this.invoice[o.fields[t.item.properties.id][c].key]=n[o.fields[t.item.properties.id][c].value];this.invoice.products=[],this.invoiceAction=t.item.properties.id,this.generateInvoice=!0,setTimeout(()=>{this.generateInvoice=!1},100)}}toolbarClick(t){"e-excelexport"===t.item.prefixIcon?this.grid.excelExport({exportType:"CurrentPage"}):"e-pdfexport"===t.item.prefixIcon&&this.grid.pdfExport({exportType:"CurrentPage"})}}return e.\u0275fac=function(t){return new(t||e)(i.Y36(u.e),i.Y36(h.f),i.Y36(v.s),i.Y36(x.l),i.Y36(p.F0),i.Y36(p.gz),i.Y36(T.e))},e.\u0275cmp=i.Xpm({type:e,selectors:[["app-dynamic-grid"]],viewQuery:function(t,n){if(1&t&&(i.Gf(r.b,5),i.Gf(C,5),i.Gf(E,5),i.Gf(S,5),i.Gf(G,5)),2&t){let o;i.iGM(o=i.CRH())&&(n.form=o.first),i.iGM(o=i.CRH())&&(n.grid=o.first),i.iGM(o=i.CRH())&&(n.orderForm=o.first),i.iGM(o=i.CRH())&&(n.editSettingsTemplate=o.first),i.iGM(o=i.CRH())&&(n.container=o.first)}},hostBindings:function(t,n){1&t&&i.NdJ("resize",function(c){return n.onResize(c)},!1,i.Jf7)},inputs:{path:"path",file:"file",partOfTab:"partOfTab"},decls:2,vars:2,consts:[["style","height: 70vh",4,"ngIf"],[4,"ngIf"],[2,"height","70vh"],["container",""],["width","100%","allowTextWrap","true",3,"height","dataSource","editSettings","toolbar","allowSorting","sortSettings","allowGrouping","allowResizing","allowPaging","allowExcelExport","allowPdfExport","pageSettings","allowFiltering","filterSettings","contextMenuItems","actionComplete","toolbarClick",4,"ngIf"],["width","100%","allowTextWrap","true",3,"height","dataSource","editSettings","toolbar","allowSorting","sortSettings","allowGrouping","allowResizing","allowPaging","allowExcelExport","allowPdfExport","pageSettings","allowFiltering","filterSettings","contextMenuItems","actionComplete","toolbarClick"],["grid",""],[3,"type","field","headerText","width","class","textAlign","isPrimaryKey","editType","allowEditing","format","validationRules","allowFiltering",4,"ngFor","ngForOf"],["editSettingsTemplate",""],[3,"type","field","headerText","width","textAlign","isPrimaryKey","editType","allowEditing","format","validationRules","allowFiltering"],["template",""],[3,"class","click",4,"ngIf"],[3,"click"],["class","mat-icon notranslate material-icons mat-icon-no-color","aria-hidden","false",4,"ngIf"],["aria-hidden","false",1,"mat-icon","notranslate","material-icons","mat-icon-no-color"],["ejs-dropdownbutton","","class","background-none",3,"items","content","select",4,"ngIf"],["ejs-dropdownbutton","",1,"background-none",3,"items","content","select"],[4,"ngFor","ngForOf"],[3,"innerHtml",4,"ngIf"],[3,"innerHtml"],["ngForm",""],[1,"form-row"],[3,"config","partOfGrid","submit",4,"ngIf"],[3,"config","partOfGrid","submit"],["form","dynamicForm"]],template:function(t,n){1&t&&(i.YNc(0,I,2,0,"div",0),i.YNc(1,V,3,1,"div",1)),2&t&&(i.Q6J("ngIf",n.loader),i.xp6(1),i.Q6J("ngIf",!n.loader))},directives:[d.O5,y.R,l.MwP,l.SRY,l.NQQ,d.sg,l.iKq,l.fMR,b.Hw,w._z,D.JL,r.b],styles:[""]}),e})()}}]);